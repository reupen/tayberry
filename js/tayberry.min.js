!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.Tayberry=e()}(this,function(){"use strict";function t(t){return t}function e(t){return null===t||"undefined"==typeof t||isNaN(t)&&"number"==typeof t}function i(){for(var t=arguments.length,i=Array(t),s=0;t>s;s++)i[s]=arguments[s];for(var n=0;n<i.length;n++)if(!e(i[n]))return i[n]}function s(i,s,n){var o,a,r=arguments.length<=3||void 0===arguments[3]?!1:arguments[3];if(!i.reduce||n||r){var l=!1;for(n=n||t,a=0;a<i.length;a++){var h=n(i[a],a);r&&e(h)||(o=l?s(o,h):h,l=!0)}}else o=i.reduce(function(t,e){return s(t,e)});return o}function n(t){return t.every(function(t){return!t})}function o(t,e){return y(!1,t,e)}function a(t,e){return y(!0,t,e)}function r(t,e,i){return t.replace(/{(\w+)}/g,function(t,s){var n=e[s];return"undefined"!=typeof n?i?d(n):n:t})}function l(t){return Math.floor(Math.log(t)/Math.log(10))}function h(t){var e=arguments.length<=1||void 0===arguments[1]?0:arguments[1],i=t.toFixed(e).split(".");return i[0]=i[0].replace(/\B(?=(\d{3})+(?!\d))/g,","),i.join(".")}function u(t){var e=arguments.length<=1||void 0===arguments[1]?"":arguments[1],i=arguments.length<=2||void 0===arguments[2]?"":arguments[2],s=arguments.length<=3||void 0===arguments[3]?2:arguments[3],n=l(t);return n=0>n?-n+s-1:0,function(t){return e+h(t,n)+i}}function c(t){var e=arguments.length<=1||void 0===arguments[1]?"":arguments[1],i=arguments.length<=2||void 0===arguments[2]?"":arguments[2],s=arguments.length<=3||void 0===arguments[3]?2:arguments[3];return function(t){return e+h(t,s)+i}}function p(t){var e=arguments.length<=1||void 0===arguments[1]?"":arguments[1],i=arguments.length<=2||void 0===arguments[2]?"%":arguments[2],s=arguments.length<=3||void 0===arguments[3]?2:arguments[3],n=l(100*t);return n=s>n?-n+s-1:0,function(t){return e+h(100*t,n)+i}}function d(t){var e=document.createElement("div");return e.appendChild(document.createTextNode(t)),e.innerHTML}function g(t,e){var i,s;return function(){var n=this,o=Date.now(),a=arguments;i&&i+e>o?(clearTimeout(s),s=setTimeout(function(){i=o,t.apply(n,a)},e)):(i=o,t.apply(n,a))}}var f={};f["typeof"]="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol?"symbol":typeof t},f.classCallCheck=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},f.createClass=function(){function t(t,e){for(var i=0;i<e.length;i++){var s=e[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}return function(e,i,s){return i&&t(e.prototype,i),s&&t(e,s),e}}(),f.get=function X(t,e,i){null===t&&(t=Function.prototype);var s=Object.getOwnPropertyDescriptor(t,e);if(void 0===s){var n=Object.getPrototypeOf(t);return null===n?void 0:X(n,e,i)}if("value"in s)return s.value;var o=s.get;if(void 0!==o)return o.call(i)},f.inherits=function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)},f.possibleConstructorReturn=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e},f.slicedToArray=function(){function t(t,e){var i=[],s=!0,n=!1,o=void 0;try{for(var a,r=t[Symbol.iterator]();!(s=(a=r.next()).done)&&(i.push(a.value),!e||i.length!==e);s=!0);}catch(l){n=!0,o=l}finally{try{!s&&r["return"]&&r["return"]()}finally{if(n)throw o}}return i}return function(e,i){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return t(e,i);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();var m=function(){function t(){f.classCallCheck(this,t),this.selectedItem={},this.containerElement=null,this.labelsCanvas=null,this.labelsCtx=null,this.options=null,this.scaleFactor=null,this.titleFont=null,this.plotArea=null,this.categories=[],this.titleFont=null,this.labelFont=null,this.legendFont=null,this.renderers=[],this.onClickReal=null,this.onMouseLeaveReal=null,this.onMouseMoveReal=null,this.onWindowResizeReal=null,this.pendingAnimations=[],this.callbacks={onResize:[],onInit:[]}}return f.createClass(t,[{key:"seriesCount",get:function(){return this.options.series.length}},{key:"categoryCount",get:function(){return this.options.series.length?this.options.series[0].data.length:0}}]),t}(),y=function R(t,e,i){if(Array.isArray(i)||(i=[i]),!t&&Object.assign)return Object.assign.apply(Object,[e].concat(i));if(void 0===e||null===e)throw new TypeError("Cannot convert first argument to object");for(var s=Object(e),n=0;n<i.length;n++){var o=i[n];if(void 0!==o&&null!==o){o=Object(o);for(var a=Object.keys(o),r=0,l=a.length;l>r;r++){var h=a[r],u=o[h],c=Object.getOwnPropertyDescriptor(o,h);void 0!==c&&c.enumerable&&(t&&!Array.isArray(u)&&"object"===("undefined"==typeof u?"undefined":f["typeof"](u))&&null!==u?s[h]=R(!0,{},[s[h],u]):s[h]=u)}}}return s},v=function(){function t(e,i,s,n,o){f.classCallCheck(this,t),this.tayberry=e,this.options=s,this.axisType=n,this.isHorizontal=o,this.index=i,this.tickStep=null,this.min=null,this.max=null,this.tickStart=null,this.tickEnd=null,this.calculatedSize=0,this.topAdjustment=0,this.rightAdjustment=0,this.titleFont=null,this.labelFont=null,this.numLabelLines=1,this.setPlacement()}return f.createClass(t,null,[{key:"create",value:function(t,e,i,s,n){var o="x"===s&&!n||"y"===s&&n;return"linear"===e.type?new x(t,i,e,s,o):new b(t,i,e,s,o)}}]),f.createClass(t,[{key:"updateFonts",value:function(){this.labelFont=this.tayberry.createFontString(this.options.font),this.titleFont=this.tayberry.createFontString(this.options.title.font)}},{key:"setPlacement",value:function(){var t=["left","right","top","bottom","start","end"];-1===t.indexOf(this.options.placement)&&(this.options.placement=this.isVertical^this.index>0?"start":"end")}},{key:"maxLabelSize",value:function(){var t=this,e=this.tayberry,i=this.getTicks();return s(i,Math.max,function(i){return e.getTextWidth(t.options.labelFormatter(i.value),t.labelFont)})}},{key:"mapLogicalXOrYUnit",value:function(t){return this.isVertical?this.tayberry.mapLogicalXUnit(t):this.tayberry.mapLogicalYUnit(t)}},{key:"mapLogicalYOrXUnit",value:function(t){return this.isVertical?this.tayberry.mapLogicalYUnit(t):this.tayberry.mapLogicalXUnit(t)}},{key:"adjustSize",value:function(t,e,i){var s=0,n=this.tayberry,o=void 0,a=n.getFontHeight(this.options.title.font),r=n.getFontHeight(this.options.font);if(i&&(this.calculatedSize=0,this.topAdjustment=0,this.rightAdjustment=0,this.numLabelLines=1),s+=this.mapLogicalXOrYUnit(n.options.elementSmallPadding),this.options.title.text&&(s+=this.mapLogicalXOrYUnit(n.options.elementSmallPadding)+a),!e){var l=this.getTicks(!1);if(this.isVertical){if(l.length){var h=l[l.length-1],u=h.y-r/2;if(u<t.top-this.topAdjustment){var c=t.top-u-this.topAdjustment+1;t.top+=c,this.topAdjustment+=c}}s+=this.maxLabelSize()}else{for(var p=void 0,d=0;d<l.length;d++){var g=l[d],f=n.getTextWidth(this.options.labelFormatter(g.value),this.labelFont),m=g.x-f/2,y=g.x+f/2;if("undefined"!=typeof p&&p+1>=m){this.numLabelLines=2;break}p=y}if(l.length){var h=l[l.length-1],f=n.getTextWidth(this.options.labelFormatter(h.value),this.labelFont),v=h.x+f/2;if(v>=t.right+this.rightAdjustment){var c=v-t.right-this.rightAdjustment+1;t.right-=c,this.rightAdjustment+=c}}s+=r*this.numLabelLines}}return this.isPlacedAtStart?this.isVertical?t.left+=s-this.calculatedSize:t.top+=s-this.calculatedSize:(s*=-1,this.isVertical?t.right+=s-this.calculatedSize:t.bottom+=s-this.calculatedSize),o=this.calculatedSize!==s,this.calculatedSize=s,o}},{key:"calculateExtent",value:function(){}},{key:"getCategoryLabel",value:function(){}},{key:"draw",value:function(t){this.drawTicksAndLabels(t),this.drawTitle(t)}},{key:"drawTicksAndLabels",value:function(t){var e=this,i=this.tayberry,s=this.mapLogicalXOrYUnit(i.options.elementSmallPadding),n=this.isVertical?s*(this.isPlacedAtStart?-1:1):0,o=this.isVertical?0:s*(this.isPlacedAtStart?-1:1),a=i.getFontHeight(this.options.font),r=this.isVertical?t[this.startProperty]:0,l=this.isVertical?0:t[this.startProperty];i.labelsCtx.save(),i.labelsCtx.font=this.labelFont,i.labelsCtx.fillStyle=this.options.font.colour,i.labelsCtx.textAlign=this.isVertical?this.isPlacedAtStart?"right":"left":"center",i.labelsCtx.textBaseline=this.isVertical?"middle":this.isPlacedAtStart?"bottom":"top";var h=[],u=0,c=0;this.enumerateTicks(function(t){var s=void 0,p=void 0,d=e.options.labelFormatter(t.value),g=u%e.numLabelLines,f=e.isVertical?0:a*g,m=i.getTextWidth(d,e.labelFont);e.isVertical||(s=t.x-m/2,p=t.x+m/2),(e.isVertical||("undefined"==typeof h[g]||s>h[g]+1)&&s>=0&&p<i.labelsCanvas.width)&&(c=Math.max(c,m),i.labelsCtx.fillText(d,t.x+n+r,t.y+o+f+l),h[g]=p),e.options.gridLines.colour&&i.drawLine(t.x1,t.y1,t.x2,t.y2,e.options.gridLines.colour),u++}),this.adjustOffsetRect(t,this.isVertical?c+s:a+s),i.labelsCtx.restore()}},{key:"adjustOffsetRect",value:function(t,e){t[this.startProperty]+=this.isPlacedAtStart?-e:e}},{key:"drawTitle",value:function(t){if(this.options.title.text){var e=this.tayberry;e.labelsCtx.save(),e.labelsCtx.font=this.titleFont,e.labelsCtx.fillStyle=this.options.title.font.colour,e.labelsCtx.textAlign="center";var i=this.mapLogicalXOrYUnit(e.options.elementSmallPadding),s=i*(this.isPlacedAtStart?-1:1),n=this.isVertical?t[this.startProperty]:0,o=this.isVertical?0:t[this.startProperty],a=e.getFontHeight(this.options.title.font);if(this.isVertical){e.labelsCtx.textBaseline="bottom";var r=e.plotArea[this.startProperty]+n+s,l=e.plotArea.yMidpoint+o;e.labelsCtx.translate(r,l),e.labelsCtx.rotate((this.isPlacedAtStart?-1:1)*Math.PI/2),e.labelsCtx.fillText(this.options.title.text,0,0)}else{e.labelsCtx.textBaseline=this.isPlacedAtStart?"bottom":"top";var r=e.plotArea.xMidpoint+n,l=e.plotArea[this.startProperty]+s+o;e.labelsCtx.fillText(this.options.title.text,r,l)}this.adjustOffsetRect(t,a+i),e.labelsCtx.restore()}}},{key:"getTicks",value:function(){var t=arguments.length<=0||void 0===arguments[0]?!0:arguments[0],e=[];return this.enumerateTicks(function(t){e.push(t)},t),e}},{key:"getOrigin",value:function(){}},{key:"updateFormatter",value:function(){}},{key:"isPlacedAtStart",get:function(){return"left"===this.options.placement||"bottom"===this.options.placement||"start"===this.options.placement}},{key:"isYAxis",get:function(){return"y"===this.axisType}},{key:"isVertical",get:function(){return!this.isHorizontal}},{key:"startProperty",get:function(){return this.isVertical?this.isPlacedAtStart?"left":"right":this.isPlacedAtStart?"top":"bottom"}},{key:"endProperty",get:function(){return this.isVertical?this.isPlacedAtStart?"right":"left":this.isPlacedAtStart?"bottom":"top"}},{key:"valueOrigin",get:function(){return this.min<=0&&0<=this.max?0:this.min>0?this.min:this.max}}]),t}(),b=function(e){function i(){return f.classCallCheck(this,i),f.possibleConstructorReturn(this,Object.getPrototypeOf(i).apply(this,arguments))}return f.inherits(i,e),f.createClass(i,[{key:"enumerateTicks",value:function(t){var e=this.tayberry,i=this.options.categories.length,s=e.plotArea.clone();this.isVertical&&s.swapXY();var n=s.width/e.categoryCount,o=.5;if(!this.isVertical)switch(this.options.labelPosition){case"left":o=0;break;case"right":o=1}for(var a=0;i>a;a++){var r=this.options.categories[a],l=this.isPlacedAtStart?s.top:s.bottom,h=this.isPlacedAtStart?s.bottom:s.top,u=s.left+Math.floor(a*n),c=u,p=s.left+Math.floor(a*n+n*o),d=l;if(this.isVertical){var g=[l,u,h,c,d,p];u=g[0],l=g[1],c=g[2],h=g[3],p=g[4],d=g[5]}t({value:r,x1:u,y1:l,x2:c,y2:h,x:p,y:d})}}},{key:"updateFormatter",value:function(){this.options.labelFormatter||(this.options.labelFormatter=t)}},{key:"getCategoryLabel",value:function(t){return this.options.labelFormatter(this.options.categories[t])}},{key:"getOrigin",value:function(){return this.tayberry.plotArea[this.isVertical?"bottom":"left"]}},{key:"getValueDisplacement",value:function(t){var e=this.getOrigin()+this.plotDisplacement*(t+.5)/this.options.categories.length;return e=this.isVertical?Math.floor(e):Math.ceil(e)}},{key:"plotDisplacement",get:function(){return this.isVertical?-this.tayberry.plotArea.height:this.tayberry.plotArea.width}}]),i}(v),x=function(t){function i(){return f.classCallCheck(this,i),f.possibleConstructorReturn(this,Object.getPrototypeOf(i).apply(this,arguments))}return f.inherits(i,t),f.createClass(i,[{key:"updateFormatter",value:function(){this.options.labelFormatter||("percentage"===this.options.labelFormat?this.options.labelFormatter=p(this.max-this.min,this.options.labelPrefix,this.options.labelSuffix):"currency"===this.options.labelFormat?this.options.labelFormatter=c(this.max-this.min,this.options.labelPrefix||this.options.currencySymbol,this.options.labelSuffix):this.options.labelFormatter=u(this.max-this.min,this.options.labelPrefix,this.options.labelSuffix))}},{key:"enumerateTicks",value:function(t){for(var e=this.tayberry,i=this.startProperty,s=this.endProperty,n=this.tickStart;n<=this.tickEnd&&this.tickStep;){var o=this.getValueDisplacement(n);if(this.isVertical){if(t({value:n,x1:e.plotArea[i],y1:o,x2:e.plotArea[s],y2:o,x:e.plotArea[i],y:o}))break}else if(t({value:n,y1:e.plotArea[i],x1:o,y2:e.plotArea[s],x2:o,y:e.plotArea[i],x:o}))break;n=this.tickStart+Math.round((n+this.tickStep-this.tickStart)/this.tickStep)*this.tickStep}}},{key:"calculateExtent",value:function(){var t=void 0,s=void 0,n=void 0,o=this.options.min,a=this.options.max,r=!e(o),l=!e(a);if(!r||!l){var h=this.isYAxis?this.tayberry.getDataMinMax(this):this.tayberry.getDataXMinMax(this),u=f.slicedToArray(h,2),c=u[0],p=u[1],d=p-c;r||(o=c,this.isYAxis&&(o-=.1*d,c>=0&&0>o&&(o=0))),l||(a=p,this.isYAxis&&(a=p+.1*d,0>=p&&o>0&&(a=0)))}if(this.options.tickStepValue)this.tickStep=this.options.tickStepValue,this.min=o,this.max=a;else{var g=a-o;t=this.plotLength/this.mapLogicalYOrXUnit(this.options.tickStep),s=g/t,n=Math.pow(10,Math.floor(Math.log(s)/Math.log(10)));var m=i.snapScaledValue(Math.ceil(s/n));this.tickStep=m*n,this.min=o,this.max=a}this.tickStart=this.options.tickStepValue&&r?this.min:Math.floor(this.min/this.tickStep)*this.tickStep,this.tickEnd=this.options.tickStepValue&&l?this.max:Math.ceil(this.max/this.tickStep)*this.tickStep,!r&&this.isYAxis&&(this.min=this.tickStart),!l&&this.isYAxis&&(this.max=this.tickEnd)}},{key:"getOrigin",value:function(){var t=this.tayberry.plotArea[this.isVertical?"bottom":"left"]-(0-this.min)*this.plotDisplacement/(this.max-this.min);return this.isVertical&&t--,t=this.isVertical?Math.floor(t):Math.ceil(t)}},{key:"getValueDisplacement",value:function(t){var e=this.getOrigin()-t*this.plotDisplacement/(this.max-this.min);return e=this.isVertical?Math.floor(e):Math.ceil(e)}},{key:"getCategoryLabel",value:function(t,e,i){if(i){var s=t/e,n=(t+1)/e,o=this.max-this.min;return r("{0} ≤ x < {1}",[this.options.labelFormatter(this.min+s*o),this.options.labelFormatter(this.min+n*o)])}return this.options.labelFormatter(t)}},{key:"plotDisplacement",get:function(){return this.isVertical?this.tayberry.plotArea.height-1:-(this.tayberry.plotArea.width-1)}},{key:"plotLength",get:function(){return Math.abs(this.plotDisplacement)}}],[{key:"snapScaledValue",value:function(t){return t=1>t?1:2>t?2:2.5>t?2.5:5>t?5:10}}]),i}(v),C=function(){function t(){if(f.classCallCheck(this,t),1===arguments.length){var e=arguments[0];"string"==typeof e?this.parseString(e):(this.r=e.r,this.g=e.g,this.b=e.b,this.a=e.a)}}return f.createClass(t,[{key:"parseString",value:function(t){var e=/^#?([0-9A-F]{2})([0-9A-F]{2})([0-9A-F]{2})|^#?([0-9A-F]{1})([0-9A-F]{1})([0-9A-F]{1})$/i,i=/^rgba?\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})(\s*,\s*([0-9]*\.?[0-9]+)\s*)?\)$/i,s=e.exec(t),n=i.exec(t);if(s){var o=function(t){var e=parseInt(t,16);return e=16*e+e};this.r=s[1]?parseInt(s[1],16):o(s[4]),this.g=s[2]?parseInt(s[2],16):o(s[5]),this.b=s[3]?parseInt(s[3],16):o(s[6]),this.a=1}else{if(!n)throw new RangeError(t+" is not a valid HTML colour");this.r=parseInt(n[1]),this.g=parseInt(n[2]),this.b=parseInt(n[3]),this.a=n[5]?parseFloat(n[5]):1}return this}},{key:"clipComponent",value:function(t){return this[t]=Math.round(this[t]),this[t]=Math.min(this[t],255),this[t]=Math.max(this[t],0),this}},{key:"clip",value:function(){return this.clipComponent("r"),this.clipComponent("g"),this.clipComponent("b"),this}},{key:"increaseBy",value:function(t){return this.r+=t,this.g+=t,this.b+=t,this.clip(),this}},{key:"multiplyAlpha",value:function(t){return this.a*=t,this}},{key:"toString",value:function(){var t;return t=e(this.a)||1===this.a?r("rgb({r},{g},{b})",this):r("rgba({r},{g},{b},{a})",this)}},{key:"sum",get:function(){return this.r+this.g+this.b}}],[{key:"createFromBlend",value:function(e,s,n){var o=function(t,e){return t+n*(e-t)};return new t({r:o(e.r,s.r),g:o(e.g,s.g),b:o(e.b,s.b),a:o(i(e.a,1),i(s.a,1))}).clip()}}]),t}(),A={visible:1,hidden:2,transitioning:4},k=function(){function t(e,i,s){f.classCallCheck(this,t),this.ctx=e,this.tb=i,this.series=null,this.setSeries(s)}return f.createClass(t,[{key:"setSeries",value:function(t){var e;for(this.series=t,e=0;e<this.series.length;e++){var i=this.series[e];i.renderer=this}}},{key:"getVisibleSeriesCount",value:function(t){for(var e=0,i=0;i<this.series.length;i++)if(i!==t){var s=this.series[i];s.visible&A.visible&&e++}return e}},{key:"onToggleSeriesAnimationFrame",value:function(){}},{key:"onAnimationFrame",value:function(){this.onToggleSeriesAnimationFrame()}},{key:"drawLegendIndicator",value:function(t,e,i,s){t.fillStyle=s?e.highlightColour:e.colour,e.visible&A.visible||(t.fillStyle=new C(t.fillStyle).multiplyAlpha(this.tb.options.legend.hiddenAlphaMultiplier).toString()),t.fillRect(i.left,i.top,i.width,i.height)}},{key:"drawLabel",value:function(t,e,i){this.tb.options.swapAxes&&(i=i.clone().swapXY());var s=(i.left+i.right)/2,n=void 0;n="top"===this.tb.options.labels.verticalAlignment?i.top:"bottom"===this.tb.options.labels.verticalAlignment?i.bottom:(i.top+i.bottom)/2;var o="middle",a="center";if(this.tb.options.swapAxes){var r=[n,s];s=r[0],n=r[1],"outside"===this.tb.options.labels.verticalPosition?a="left":"inside"===this.tb.options.labels.verticalPosition&&(a="right")}else o=m.mapVerticalPosition(t,this.tb.options.labels.verticalPosition);this.tb.plotArea.containsPoint(s,n)&&(this.ctx.save(),this.ctx.textAlign=a,this.ctx.textBaseline=o,this.ctx.fillText(e,s,n),this.ctx.restore())}},{key:"drawPlot",value:function(){}},{key:"drawLabels",value:function(){}},{key:"hitTest",value:function(){}}]),t}(),S=function(){function t(e){var i=arguments.length<=1||void 0===arguments[1]?0:arguments[1];f.classCallCheck(this,t),this.renderer=e,this.tb=e.tb,this.categoryCount=this.renderer.series[0].data.length,this.categoryIndex=0,this.seriesIndex=0,this.seriesCount=this.renderer.series.length,this.categoryCount&&(this.isHorizontal=this.tb.options.swapAxes,this.plotArea=this.tb.plotArea.clone(),this.isHorizontal&&this.plotArea.swapXY(),this.startCategoryIndex=Math.max(i,0),this.startCategoryIndex=Math.min(this.startCategoryIndex,this.categoryCount-1),this.categoryIndex=this.startCategoryIndex)}return f.createClass(t,[{key:"nextValue",value:function(){}}]),t}(),w=function(t){function i(){return f.classCallCheck(this,i),f.possibleConstructorReturn(this,Object.getPrototypeOf(i).apply(this,arguments))}return f.inherits(i,t),f.createClass(i,[{key:"nextValue",value:function(){var t=void 0;do{if(this.seriesIndex+1===this.seriesCount){if(this.seriesIndex=0,this.categoryIndex++,this.categoryIndex>=this.categoryCount)break}else this.seriesIndex++;t=m.getDataValue(this.renderer.series[this.seriesIndex].data[this.categoryIndex])}while(e(t))}}]),i}(S),M=function(t){function i(){return f.classCallCheck(this,i),f.possibleConstructorReturn(this,Object.getPrototypeOf(i).apply(this,arguments))}return f.inherits(i,t),f.createClass(i,[{key:"nextValue",value:function(){var t=void 0;do{if(this.categoryIndex+1===this.categoryCount){if(this.categoryIndex=this.startCategoryIndex,this.seriesIndex++,this.seriesIndex>=this.seriesCount)break}else this.categoryIndex++;t=m.getDataValue(this.renderer.series[this.seriesIndex].data[this.categoryIndex])}while(e(t))}}]),i}(S),P=function(){function t(){if(f.classCallCheck(this,t),1===arguments.length)if("object"===f["typeof"](arguments[0])){var e=arguments[0];this.left=e.left,this.top=e.top,this.right=e.right,this.bottom=e.bottom}else{var i=arguments[0];this.left=i,this.top=i,this.right=i,this.bottom=i}else 4===arguments.length&&(this.left=arguments[0],this.top=arguments[1],this.right=arguments[2],this.bottom=arguments[3])}return f.createClass(t,[{key:"containsPoint",value:function(t,e){return this.containsX(t)&&this.containsY(e)}},{key:"containsY",value:function(t){return t>=this.top&&t<this.bottom||t>=this.bottom&&t<this.top}},{key:"containsX",value:function(t){return t>=this.left&&t<this.right||t>=this.right&&t<this.left}},{key:"inflate",value:function(t){return this.left-=t,this.top-=t,this.right+=t,this.bottom+=t,this}},{key:"clip",value:function(t){return this.left<t.minX?this.left=t.minX:this.left>t.maxX&&(this.left=t.maxX),this.right<t.minX?this.right=t.minX:this.right>t.maxX&&(this.right=t.maxX),this.top<t.minY?this.top=t.minY:this.top>t.maxY&&(this.top=t.maxY),this.bottom>t.maxY?this.bottom=t.maxY:this.bottom<t.minY&&(this.bottom=t.minY),this}},{key:"clone",value:function(){return new t(this)}},{key:"swapXY",value:function(){var t=[this.top,this.left];this.left=t[0],this.top=t[1];var e=[this.right,this.bottom];return this.bottom=e[0],this.right=e[1],this}},{key:"width",get:function(){return this.right-this.left}},{key:"height",get:function(){return this.bottom-this.top}},{key:"maxY",get:function(){return Math.max(this.bottom,this.top)}},{key:"minY",get:function(){return Math.min(this.bottom,this.top)}},{key:"minX",get:function(){return Math.min(this.left,this.right)}},{key:"maxX",get:function(){return Math.max(this.left,this.right)}},{key:"xMidpoint",get:function(){return(this.left+this.right)/2}},{key:"yMidpoint",get:function(){return(this.top+this.bottom)/2}},{key:"area",get:function(){return Math.abs(this.width)*Math.abs(this.height)}}]),t}(),F=function(t){function i(t,e,s){f.classCallCheck(this,i);var n=f.possibleConstructorReturn(this,Object.getPrototypeOf(i).call(this,t,e,s));return n.barPositions=null,n.tb.registerCallback("onResize",n.updateBarWidths.bind(n)),n.tb.registerCallback("onInit",n.updateBarWidths.bind(n)),n}return f.inherits(i,t),f.createClass(i,[{key:"updateBarWidths",value:function(){for(var t=this.series[0].data.length,e="stacked"===this.tb.options.barPlot.mode,i="overlaid"===this.tb.options.barPlot.mode,s=!e&&!i,n=this.series.length,o=this.tb.options.swapAxes?this.tb.plotArea.clone().swapXY():this.tb.plotArea,a=o.width/t,r=0,l=0,h=0;n>h;h++){var u=this.series[h],c=u.rState;if(u.animationState){if(!u.animationState.subtype){var p=this.getVisibleSeriesCount(h);s&&p>0?u.animationState.subtype="width":e&&p>0?u.animationState.subtype="height":u.animationState.subtype="fade",c.colour=u.colour}var d="show"===u.animationState.type;if("width"===u.animationState.subtype)c.multiplier=d?u.animationState.stage:1-u.animationState.stage,c.yMultiplier=1;else if("height"===u.animationState.subtype)c.yMultiplier=d?u.animationState.stage:1-u.animationState.stage,c.multiplier=1;else{var g=new C(u.colour);g.a=0,d?c.colour=C.createFromBlend(g,new C(u.colour),u.animationState.stage).toString():c.colour=C.createFromBlend(new C(u.colour),g,u.animationState.stage).toString(),c.yMultiplier=1,c.multiplier=1}++r}else u.visible&A.visible?(c.multiplier=1,c.yMultiplier=1):(c.multiplier=0,c.yMultiplier=0);l+=c.multiplier}var f=e||i?1:l,y=this.series[0].yAxis.getOrigin();this.barPositions=[];for(var v=0;t>v;v++){for(var b=y,x=y,k=0,S=0,w=o.left+Math.floor(v*a),M=o.left+Math.floor((v+1)*a),P=w+Math.ceil(a*this.tb.options.barPlot.categorySpacing/2),F=M-Math.floor(a*this.tb.options.barPlot.categorySpacing/2),I=[],T=0,L=0,h=0;n>h;h++){var u=this.series[h],c=u.rState,V=m.getDataValue(u.data[v])*c.yMultiplier,E=Math.floor(c.multiplier*Math.floor((F-P)/f)),O=Math.floor(P+L)+Math.ceil(u.xAxis.mapLogicalXOrYUnit(this.tb.options.barPlot.barPadding)/2),Y=Math.ceil(P+L+E)-Math.floor(u.xAxis.mapLogicalXOrYUnit(this.tb.options.barPlot.barPadding)/2),X=u.yAxis.getValueDisplacement(V+(V>0?k:S)),R=e?V>0?b:x:y;I.push([O,X,Y,R]),e?V>0?(k+=V,b=X):(S+=V,x=X):s&&(T++,L+=E)}this.barPositions.push(I)}}},{key:"onToggleSeriesAnimationFrame",value:function(){this.updateBarWidths()}},{key:"drawPlot",value:function(){this.ctx.save();for(var t=new I(this),e=void 0;e=t.next();)e.series.visible&(A.visible|A.transitioning)&&(this.ctx.fillStyle=e.selected?e.series.rState.highlightColour:e.series.rState.colour,this.ctx.fillRect(e.rect.left,e.rect.top,e.rect.width,e.rect.height));this.ctx.restore()}},{key:"drawLabels",value:function(){if(this.tb.options.labels.enabled){this.ctx.save();for(var t=new I(this),e=void 0;e=t.next();)(e.series.visible&(A.visible|A.transitioning))===A.visible&&(this.ctx.font=this.tb.labelFont,this.ctx.fillStyle=this.tb.options.labels.font.colour,this.drawLabel(e.value,e.series.yAxis.options.labelFormatter(e.value),e.rect));this.ctx.restore()}}},{key:"hitTest",value:function(t,i){var s={found:!1,plotType:"bar",type:"plotItem",isXRange:!0},n=this.series[0].data.length,a=this.tb.options.swapAxes,r=this.tb.plotArea.clone();a&&r.swapXY();for(var l=Math.floor(n*((a?i:t)-r.left)/r.width),h=[],u=new I(this,l),c=void 0;(c=u.next())&&!(c.categoryIndex>l);)if(c.series.visible&(A.visible|A.transitioning)){var p=void 0,d=void 0,g=void 0;if(c.rect.containsPoint(t,i))p=0,d=0;else if(c.rect.containsX(t))p=i<c.rect.top?c.rect.top-i:i-c.rect.bottom,d=a?2:1;else if(c.rect.containsY(i))p=t<c.rect.left?c.rect.left-t:t-c.rect.right,d=a?1:2;else{var f=Math.min(Math.abs(t-c.rect.left),Math.abs(t-c.rect.right)),y=Math.min(Math.abs(i-c.rect.top),Math.abs(i-c.rect.bottom));g=Math.sqrt(Math.pow(f,2)+Math.pow(y,2)),p=a?y:f,d=3}"undefined"==typeof g&&(g=p),e(g)||h.push({sortDistance:p,distance:g,priority:d,data:{categoryIndex:c.categoryIndex,seriesIndex:c.seriesIndex,rect:c.rect,series:c.series,value:m.getDataValue(this.series[c.seriesIndex].data[c.categoryIndex])}})}return h.length&&(h.sort(function(t,e){var i=t.priority-e.priority;return i||(i=t.sortDistance-e.sortDistance),i||(i=t.data.rect.height-e.data.rect.height),i}),s.found=!0,s.normalisedDistance=h[0].distance+Math.sqrt(h[0].data.rect.area),s.normalisedDistance<0&&(s.normalisedDistance=0),s=o(s,h[0].data)),s}}]),i}(k),I=function(t){function e(){return f.classCallCheck(this,e),f.possibleConstructorReturn(this,Object.getPrototypeOf(e).apply(this,arguments))}return f.inherits(e,t),f.createClass(e,[{key:"next",value:function(){var t=void 0;if(this.categoryIndex<this.categoryCount){var e=f.slicedToArray(this.renderer.barPositions[this.categoryIndex][this.seriesIndex],4),i=e[0],s=e[1],n=e[2],o=e[3],a=new P(i,s,n,o);a.right<a.left&&(a.right=a.left),this.isHorizontal&&a.swapXY(),a.clip(this.tb.plotArea),t={seriesIndex:this.seriesIndex,categoryIndex:this.categoryIndex,series:this.renderer.series[this.seriesIndex],value:m.getDataValue(this.renderer.series[this.seriesIndex].data[this.categoryIndex]),rect:a,selected:"plotItem"===this.tb.selectedItem.type&&this.tb.selectedItem.categoryIndex===this.categoryIndex&&(this.tb.options.tooltips.shared||this.tb.selectedItem.series===this.renderer.series[this.seriesIndex])},this.nextValue()}return t}}]),e}(w),T=0,L=["square","diamond","circle","triangle","triangle-inversed"],V=function(t){function e(t,i,s){f.classCallCheck(this,e);var n=f.possibleConstructorReturn(this,Object.getPrototypeOf(e).call(this,t,i,s));return n.pointPositions=null,n.tb.registerCallback("onResize",n.updatPointPositions.bind(n)),n.tb.registerCallback("onInit",n.updatPointPositions.bind(n)),n}return f.inherits(e,t),f.createClass(e,[{key:"updatPointPositions",value:function(){var t=this.series.length;this.pointPositions=[];for(var e=0;t>e;e++){var i=this.series[e],s=i.rState;if(i.animationState){i.animationState.subtype||(i.animationState.subtype="height");var n="show"===i.animationState.type;"height"===i.animationState.subtype&&(s.yMultiplier=n?i.animationState.stage:1-i.animationState.stage,s.xMultiplier=1)}else i.visible&A.visible?(s.xMultiplier=1,s.yMultiplier=1):(s.xMultiplier=1,s.yMultiplier=0)}for(var e=0;t>e;e++){for(var i=this.series[e],s=i.rState,o=i.data.length,a=i.yAxis.valueOrigin,r=[],l=0;o>l;l++){var h=m.getDataValue(i.data[l]),u=m.getDataXValue(i.data,l),c=a+s.yMultiplier*(h-a),p=i.xAxis.getValueDisplacement(u)*s.xMultiplier,d=i.yAxis.getValueDisplacement(c);r.push([p,d])}this.pointPositions.push(r)}}},{key:"setSeries",value:function(t){for(var i=0,s=0;s<t.length;s++)t[s].markerType||(t[s].markerType=L[T%L.length],T++),i+=t[s].data.length;var n=this.tb.options.linePlot.showMarkers;this.showMarkers="auto"===n?i<this.tb.options.linePlot.noMarkersThreshold:n,f.get(Object.getPrototypeOf(e.prototype),"setSeries",this).call(this,t)}},{key:"drawMarker",value:function(t,e,i,s){var n=arguments.length<=4||void 0===arguments[4]?this.ctx:arguments[4];"square"===t?n.fillRect(e-s/2,i-s/2,s,s):"diamond"===t?(n.save(),n.translate(e,i),n.rotate(-Math.PI/4),n.fillRect(0-s/2,0-s/2,s,s),n.restore()):"circle"===t?(s=Math.round(1.2*s),n.beginPath(),n.arc(e,i,s/2,0,2*Math.PI),n.fill()):("triangle"===t||"triangle-inversed"===t&&(s=-s))&&(s=Math.round(1.2*s),n.beginPath(),n.moveTo(e-s/2,i+s/2),n.lineTo(e,i-s/2),n.lineTo(e+s/2,i+s/2),n.closePath(),n.fill())}},{key:"onToggleSeriesAnimationFrame",value:function(){this.updatPointPositions()}},{key:"drawPlot",value:function(){this.ctx.save();for(var t=new E(this),e=void 0;e=t.next();)e.series.visible&(A.visible|A.transitioning)&&(e.firstPoint?(this.ctx.lineWidth=e.seriesSelected?this.tb.options.linePlot.highlightedLineWidth:this.tb.options.linePlot.lineWidth,this.ctx.strokeStyle=e.seriesSelected?e.series.rState.highlightColour:e.series.rState.colour,this.ctx.beginPath(),this.ctx.moveTo(e.x,e.y)):this.ctx.lineTo(e.x,e.y),e.lastPoint&&this.ctx.stroke());if(this.showMarkers)for(t=new E(this);e=t.next();)e.series.visible&(A.visible|A.transitioning)&&(e.selected&&(this.ctx.fillStyle=e.series.rState.glowColour,this.drawMarker(e.series.markerType,e.x,e.y,this.tb.options.linePlot.highlightedMarkerSize)),this.ctx.fillStyle=e.series.rState.colour,this.drawMarker(e.series.markerType,e.x,e.y,this.tb.options.linePlot.markerSize));this.ctx.restore()}},{key:"drawLegendIndicator",value:function(t,e,i,s){var n=s?e.highlightColour:e.colour;t.save(),t.lineWidth=2,t.strokeStyle=n,this.tb.drawLine(i.left,i.yMidpoint,i.right,i.yMidpoint),t.fillStyle=n,this.drawMarker(e.markerType,i.xMidpoint,i.yMidpoint,this.tb.options.linePlot.markerSize,t),t.restore()}},{key:"drawLabels",value:function(){if(this.tb.options.labels.enabled){this.ctx.save(),this.ctx.font=this.tb.labelFont,this.ctx.fillStyle=this.tb.options.labels.font.colour;for(var t=new E(this),e=void 0;e=t.next();)if(e.series.visible&(A.visible|A.transitioning)){var i=new P(e.x,e.y,e.x,e.y).inflate(this.tb.options.linePlot.markerSize/2);this.drawLabel(e.value,e.series.yAxis.options.labelFormatter(e.value),i)}this.ctx.restore()}}},{key:"hitTest",value:function(t,e){for(var i={found:!1,plotType:"line",type:"plotItem",isXRange:!1},s=[],n=new E(this),a=void 0;a=n.next();)if(a.series.visible&(A.visible|A.transitioning)){var r=Math.sqrt(Math.pow(a.x-t,2)+Math.pow(a.y-e,2)),l=Math.abs(this.tb.options.swapAxes?a.y-e:a.x-t);s.push({distance:r,horizontalDistance:l,priority:0,data:a})}if(s.length){s.sort(function(t,e){return t.horizontalDistance-e.horizontalDistance||t.distance-e.distance}),a=s[0].data;var h=new P(a.x,a.y,a.x,a.y).inflate(this.tb.options.linePlot.markerSize/2);o(i,[{found:!0,
rect:h,normalisedDistance:s[0].distance+Math.sqrt(h.area)},a])}return i}}]),e}(k),E=function(t){function e(){return f.classCallCheck(this,e),f.possibleConstructorReturn(this,Object.getPrototypeOf(e).apply(this,arguments))}return f.inherits(e,t),f.createClass(e,[{key:"next",value:function(){var t=void 0;if(this.seriesIndex<this.seriesCount){var e=f.slicedToArray(this.renderer.pointPositions[this.seriesIndex][this.categoryIndex],2),i=e[0],s=e[1];if(this.isHorizontal){var n=[s,i];i=n[0],s=n[1]}t={firstPoint:0===this.categoryIndex,lastPoint:this.categoryIndex+1===this.categoryCount,seriesIndex:this.seriesIndex,categoryIndex:this.categoryIndex,series:this.renderer.series[this.seriesIndex],value:m.getDataValue(this.renderer.series[this.seriesIndex].data[this.categoryIndex]),x:i,y:s,seriesSelected:"plotItem"===this.tb.selectedItem.type&&!this.tb.options.tooltips.shared&&this.tb.selectedItem.series===this.renderer.series[this.seriesIndex],selected:"plotItem"===this.tb.selectedItem.type&&this.tb.selectedItem.categoryIndex===this.categoryIndex&&(this.tb.options.tooltips.shared||this.tb.selectedItem.series===this.renderer.series[this.seriesIndex])},this.nextValue()}return t}}]),e}(M),O=0;m.getAutoColour=function(){var t=m.defaultColours[O%m.defaultColours.length];return O++,t},m.getDataValue=function(t){var e=void 0;return e=Array.isArray(t)?t[1]:t},m.getDataXValue=function(t,e){var i=void 0;return i=Array.isArray(t[e])?t[e][0]:e},m.setDataValue=function(t,e,i){Array.isArray(t[e])?t[e][1]=i:t[e]=i},m.prototype.createCanvas=function(){var t=document.createElement("canvas");return t.style.width=Math.floor(this.containerElement.clientWidth)+"px",t.style.width=Math.floor(this.containerElement.clientWidth)+"px",t.style.height=Math.floor(this.containerElement.clientHeight)+"px",t.style.position="absolute",this.containerElement.appendChild(t),t},m.prototype.create=function(t){"string"==typeof t?this.containerElement=document.getElementById(t):this.containerElement=t,this.labelsCanvas=this.createCanvas(),this.labelsCtx=this.labelsCanvas.getContext("2d"),this.plotCanvas=this.createCanvas(),this.plotCtx=this.plotCanvas.getContext("2d"),this.options={},this.yAxes=null,this.xAxes=null,this.initialise()},m.prototype.destroy=function(){this.labelsCanvas.parentNode.removeChild(this.labelsCanvas),this.tooltipElement.parentNode.removeChild(this.tooltipElement),this.options={},this.plotCanvas.removeEventListener("click",this.onClickReal),this.plotCanvas.removeEventListener("mousemove",this.onMouseMoveReal),this.plotCanvas.removeEventListener("mouseleave",this.onMouseLeaveReal),window.removeEventListener("resize",this.onWindowResizeReal)},m.prototype.initialise=function(){this.scaleFactor=window.devicePixelRatio||1,this.labelsCanvas.width=Math.round(this.labelsCanvas.clientWidth*this.scaleFactor),this.labelsCanvas.height=Math.round(this.labelsCanvas.clientHeight*this.scaleFactor),this.plotCanvas.width=this.labelsCanvas.width,this.plotCanvas.height=this.labelsCanvas.height,this.scaleFactorX=this.labelsCanvas.width/this.labelsCanvas.clientWidth,this.scaleFactorY=this.labelsCanvas.height/this.labelsCanvas.clientHeight,this.selectedItem={},this.plotArea=null},m.prototype.getFontHeight=function(t,e){var i=t.size;return t.autoScale&&(i*=Math.pow(this.labelsCanvas.width/800,.25)),e||(i=this.mapLogicalYUnit(i)),i},m.prototype.createFontString=function(t,e){return(t.style?t.style+" ":"")+this.getFontHeight(t,e).toFixed(1)+"px "+t.face},m.prototype.updateFonts=function(){this.titleFont=this.createFontString(this.options.title.font),this.labelFont=this.createFontString(this.options.labels.font),this.legendFont=this.createFontString(this.options.legend.font),this.yAxes.map(function(t){return t.updateFonts()}),this.xAxes.map(function(t){return t.updateFonts()})},m.prototype.setOptions=function(t){var e=[this.defaultOptions()];if(t.presets||(t.presets=["default"]),t.presets)for(var i=0;i<t.presets.length;i++)e.push(m.presets[t.presets[i]]);e.push(t),this.options=a({},e),this.options.title.font=a({},[this.options.font,this.options.title.font]),this.options.tooltips.font=a({},[this.options.font,this.options.tooltips.font]),this.options.labels.font=a({},[this.options.font,this.options.labels.font]),this.options.legend.font=a({},[this.options.font,this.options.legend.font]),this.options.allAxes.font=a({},[this.options.font,this.options.allAxes.font]),this.options.allAxes.title.font=a({},[this.options.font,this.options.allAxes.title.font]),Array.isArray(this.options.yAxis)||(this.options.yAxis=[this.options.yAxis||{}]),Array.isArray(this.options.xAxis)||(this.options.xAxis=[this.options.xAxis||{}]);for(var s=0;s<this.options.yAxis.length;s++)this.options.yAxis[s]=a({},[0===s?m.defaultPrimaryYAxis:m.defaultSecondaryYAxis,this.options.allAxes,this.options.yAxis[s]]);for(var s=0;s<this.options.xAxis.length;s++)this.options.xAxis[s]=a({},[m.defaultXAxis,this.options.allAxes,this.options.xAxis[s]]);for(var s=0;s<this.options.series.length;s++)this.options.series[s]=a({},[m.defaultSeries,this.options.series[s]]);this.yAxes=[],this.xAxes=[];for(var s=0;s<this.options.xAxis.length;s++)this.xAxes.push(v.create(this,this.options.xAxis[s],s,"x",this.options.swapAxes));for(var s=0;s<this.options.yAxis.length;s++)this.yAxes.push(v.create(this,this.options.yAxis[s],s,"y",this.options.swapAxes));this.updateFonts(),this.createRenderers(),this.calculatePlotArea(),this.callbacks.onInit.forEach(function(t){return t()}),this.plotCanvas.addEventListener("click",this.onClickReal=this.onClick.bind(this)),this.plotCanvas.addEventListener("mousemove",this.onMouseMoveReal=this.onMouseMove.bind(this)),this.plotCanvas.addEventListener("mouseleave",this.onMouseLeaveReal=this.onMouseLeave.bind(this)),window.addEventListener("resize",this.onWindowResizeReal=g(this.onWindowResize,50).bind(this))},m.calculateHighlightColour=function(t){var e=new C(t);return e.increaseBy(30*(e.sum>=540?-1:1)).toString()},m.calculateGlowColour=function(t){var e=new C(t);return e.a=.4,e.toString()},m.prototype.createRenderers=function(){var t=void 0,e={bar:[],line:[]};t=Array.isArray(this.options.series)?this.options.series:[this.options.series];for(var i=0;i<t.length;i++){var s=t[i];s.index=i,s.colour=s.colour||m.getAutoColour(),s.highlightColour=s.highlightColour||m.calculateHighlightColour(s.colour),s.glowColour=s.glowColour||m.calculateGlowColour(s.highlightColour),s.rState={colour:s.colour,highlightColour:s.highlightColour,glowColour:s.glowColour},s.xAxis=this.xAxes[s.xAxisIndex||0],s.yAxis=this.yAxes[s.yAxisIndex||0],s.plotType=s.plotType||this.options.plotType,e.hasOwnProperty(s.plotType)&&e[s.plotType].push(s)}e.bar.length&&this.renderers.push(new F(this.plotCtx,this,e.bar)),e.line.length&&this.renderers.push(new V(this.plotCtx,this,e.line))},m.prototype.getDataMinMax=function(t){var i,n,o,a;if("stacked"===this.options.barPlot.mode){var r=[],l=[],h=this.options.series.filter(function(e){return"bar"===e.plotType&&e.yAxis===t});if(h.length)for(var u=0;u<h[0].data.length;u++){r[u]=0,l[u]=0;for(var c=0;c<h.length;c++){var p=m.getDataValue(h[c].data[u]);e(p)||(0>p?l[u]+=p:r[u]+=p)}}o=Math.min(0,s(l,Math.min,void 0,!0)),a=Math.max(s(r,Math.max,void 0,!0),0)}for(var d=[],g=[],f=0;f<this.options.series.length;f++){var y=this.options.series[f];y.yAxis!==t||"bar"===y.plotType&&"stacked"===this.options.barPlot.mode||(d.push(s(y.data,Math.min,m.getDataValue,!0)),g.push(s(y.data,Math.max,m.getDataValue,!0)))}i=s(d,Math.min,void 0,!0),n=s(g,Math.max,void 0,!0);var v=s([i,o],Math.min,void 0,!0),b=s([n,a],Math.max,void 0,!0);return[v,b]},m.prototype.getDataXMinMax=function(t){for(var e,i,n=[],o=[],a=0;a<this.options.series.length;a++){var r=this.options.series[a];r.xAxis===t&&(n.push(s(r.data,Math.min,m.getDataXValue,!0)),o.push(s(r.data,Math.max,m.getDataXValue,!0)))}return e=s(n,Math.min,void 0,!0),i=s(o,Math.max,void 0,!0),[e,i]},m.prototype.createTooltip=function(){this.tooltipElement&&(this.tooltipElement.parentNode.removeChild(this.tooltipElement),this.tooltipElement=null),this.tooltipElement=document.createElement("div"),this.tooltipElement.className="tayberry-tooltip",this.tooltipElement.style.position="absolute",this.tooltipElement.style.left="0px",this.tooltipElement.style.top="0px",this.tooltipElement.style.zIndex="99999",this.tooltipElement.style.font=this.createFontString(this.options.tooltips.font,!0),this.tooltipElement.style.borderRadius="3px",this.tooltipElement.style.backgroundColor="white",this.tooltipElement.style.border="2px solid #bbb",this.tooltipElement.style.padding="0.15em 0.4em",this.tooltipElement.style.display="none",this.tooltipElement.innerHTML="",document.body.appendChild(this.tooltipElement),this.tooltipElement.addEventListener("mousemove",this.onMouseMove.bind(this)),this.tooltipElement.addEventListener("mouseleave",this.onMouseLeave.bind(this))},m.prototype.getTextWidth=function(t,e){var i=void 0;return e&&(this.labelsCtx.save(),this.labelsCtx.font=e),i=this.labelsCtx.measureText(t).width,e&&this.labelsCtx.restore(),i},m.prototype.getMultilineTextHeight=function(t,e,i){var s=void 0;return t&&(this.labelsCtx.save(),this.labelsCtx.font=t),s=this.splitMultilineText(e,i).length,t&&this.labelsCtx.restore(),s},m.prototype.splitMultilineText=function(t,e){for(var i=[],s=0,n="",o=this.labelsCtx.measureText(" ").width,a=0;a<e.length;){for(var r=a;a<e.length&&" "!==e[a]&&"\r"!==e[a]&&"\n"!==e[a];)a++;for(var l=a;a<e.length&&(" "===e[a]||"\r"===e[a]||"\n"===e[a]);)a++;if(l>r){var h=e.substring(r,l),u=this.labelsCtx.measureText(h).width;s+u>t?(s||(n=h),i.push(n),s&&(s=0,n=h)):(n+=(n?" ":"")+h,s+=u+o)}}return n&&i.push(n),i},m.prototype.drawTextMultiline=function(t,e,i,s,n){for(var o=this.splitMultilineText(s,n),a=0;a<o.length;a++){var r=o[a];this.labelsCtx.fillText(r,e,i+t*a)}},m.prototype.render=function(){if(this.drawLabelLayer(),this.createTooltip(),this.options.animations.enabled)for(var t=0;t<this.options.series.length;t++){var e=this.options.series[t];this.setSeriesVisibility(e,!0,"height")}else this.drawPlotLayer()},m.prototype.clear=function(){var t=arguments.length<=0||void 0===arguments[0]?!0:arguments[0],e=arguments.length<=1||void 0===arguments[1]?!0:arguments[1];t&&this.plotCtx.clearRect(0,0,this.plotCanvas.width,this.plotCanvas.height),e&&this.labelsCtx.clearRect(0,0,this.labelsCanvas.width,this.labelsCanvas.height)},m.prototype.drawBackground=function(){this.options.plotBackgroundColour&&(this.labelsCtx.save(),this.labelsCtx.fillStyle=this.options.plotBackgroundColour,this.labelsCtx.fillRect(this.plotArea.left,this.plotArea.top,this.plotArea.width,this.plotArea.height),this.labelsCtx.restore())},m.prototype.drawTitle=function(){if(this.options.title.text){var t=this.labelsCanvas.width/2,e=0;this.labelsCtx.save(),this.labelsCtx.textAlign="center",this.labelsCtx.textBaseline="top",this.labelsCtx.font=this.titleFont,this.labelsCtx.fillStyle=this.options.title.font.colour,this.drawTextMultiline(this.getFontHeight(this.options.title.font),t,e,this.labelsCanvas.width,this.options.title.text),this.labelsCtx.restore()}},m.prototype.drawPlotLayer=function(){for(var t=0;t<this.renderers.length;t++)this.renderers[t].drawPlot();for(var t=0;t<this.renderers.length;t++)this.renderers[t].drawLabels()},m.prototype.drawLine=function(t,e,i,s,n){var o=arguments.length<=5||void 0===arguments[5]?this.labelsCtx:arguments[5];o.save(),n&&(o.strokeStyle=n),o.beginPath(),o.moveTo(t+.5,e+.5),o.lineTo(i+.5,s+.5),o.stroke(),o.restore()},m.prototype.drawLabelLayer=function(){this.drawBackground(),this.drawTitle();var t=new P(0);this.xAxes.map(function(e){return e.draw(t)}),this.yAxes.map(function(e){return e.draw(t)}),this.drawLegend()},m.prototype.redraw=function(t){this.clear(!0,!t),t||this.drawLabelLayer(),this.drawPlotLayer()},m.prototype.registerCallback=function(t,e){this.callbacks[t].push(e)},m.prototype.onMouseLeave=function(t){(t.currentTarget==this.plotCanvas&&t.relatedTarget!==this.tooltipElement||t.currentTarget==this.tooltipElement&&t.relatedTarget!==this.plotCanvas)&&(this.selectedItem={},this.tooltipElement.style.display="none",this.redraw())},m.prototype.handleMouseMove=function(t,e){var i=new P(this.plotCanvas.getBoundingClientRect()),s=!1,n="none";if(i.containsPoint(t,e)){var o=t-i.left,a=e-i.top,l=this.hitTest(this.mapLogicalXUnit(o),this.mapLogicalYUnit(a));if(l.found)if("legend"===l.type)this.selectedItem=l,s=!0;else if("plotItem"===l.type){var h="",u=l.rect.top<l.rect.bottom;if(n="block",this.options.tooltips.shared){var c=this.xAxes[0].getCategoryLabel(l.categoryIndex,this.categoryCount,l.isXRange);h+=r(this.options.tooltips.headerTemplate,{category:c},!0);for(var p=0;p<this.seriesCount;p++){var d=this.options.series[p],g=m.getDataValue(d.data[l.categoryIndex]);h+=r(this.options.tooltips.valueTemplate,{value:d.yAxis.options.labelFormatter(g),name:d.name,colour:d.colour},!0)}}else{var d=l.series,g=l.value,c=d.xAxis.getCategoryLabel(l.categoryIndex,this.categoryCount,l.isXRange);h+=r(this.options.tooltips.headerTemplate,{category:c},!0),h+=r(this.options.tooltips.valueTemplate,{value:d.yAxis.options.labelFormatter(g),name:d.name,colour:d.colour},!0)}h+=this.options.tooltips.footerTemplate,this.tooltipElement.innerHTML=h;var f=this.tooltipElement.getBoundingClientRect();this.options.tooltips.shared||(this.tooltipElement.style.borderColor=l.series.colour),this.tooltipElement.style.left=window.pageXOffset+i.left+this.mapScreenUnit(l.rect.width)/2+l.rect.left/this.scaleFactor-f.width/2+"px",this.tooltipElement.style.top=window.pageYOffset+i.top+this.mapScreenUnit(l.rect.top)-f.height*(u?1:0)-this.options.elementSmallPadding*(u?1:-1)+"px",this.selectedItem=l,s=!0}}return this.tooltipElement.style.display=n,s},m.prototype.onClick=function(t){var e=new P(this.plotCanvas.getBoundingClientRect());if(0===t.button&&e.containsPoint(t.clientX,t.clientY)){var i=t.clientX-e.left,s=t.clientY-e.top,n=this.hitTest(this.mapLogicalXUnit(i),this.mapLogicalYUnit(s));if(n.found&&"legend"===n.type){var o=n.data.series;this.toggleSeriesVisibility(o),this.clear(!1,!0),this.drawLabelLayer()}}},m.prototype.onMouseMove=function(t){var e=o({},this.selectedItem);this.handleMouseMove(t.clientX,t.clientY)||(this.selectedItem={}),(e.type!==this.selectedItem.type||e.categoryIndex!==this.selectedItem.categoryIndex||e.series!==this.selectedItem.series)&&this.redraw()},m.prototype.onWindowResize=function(){this.tooltipElement.style.display="none",this.labelsCanvas.style.width=Math.floor(this.containerElement.clientWidth)+"px",this.labelsCanvas.style.height=Math.floor(this.containerElement.clientHeight)+"px",this.plotCanvas.style.width=Math.floor(this.containerElement.clientWidth)+"px",this.plotCanvas.style.height=Math.floor(this.containerElement.clientHeight)+"px",this.initialise(),this.updateFonts(),this.calculatePlotArea(),this.createTooltip(),this.callbacks.onResize.forEach(function(t){return t()}),this.redraw()},m.prototype.defaultOptions=function(){return{title:{text:"",font:{size:20}},font:{colour:"#444",size:12,face:"sans-serif",style:"",autoScale:!0},allAxes:{font:{},title:{font:{}}},xAxis:[],yAxis:[],animations:{enabled:!0},series:[],backgroundColour:void 0,swapAxes:!1,plotType:"bar",barPlot:{mode:"normal",barPadding:2,categorySpacing:.3},linePlot:{lineWidth:2,highlightedLineWidth:4,showMarkers:"auto",noMarkersThreshold:100,markerSize:10,highlightedMarkerSize:18},elementSmallPadding:5,elementLargePadding:10,presets:[],tooltips:{shared:!1,headerTemplate:"<strong>{category}</strong><table>",valueTemplate:'<tr><td style="padding-right: 0.5em"><span style="color: {colour}">●</span> {name}</td><td style="text-align: right">{value}</td></tr>',footerTemplate:"</table>",font:{}},legend:{enabled:!0,indicatorSize:15,font:{},hiddenAlphaMultiplier:.5},labels:{enabled:!1,verticalAlignment:"top",verticalPosition:"outside",font:{}}}},m.defaultSeries={visible:A.visible},m.defaultXAxis={title:{text:"",font:{}},type:"categorial",min:null,max:null,tickStep:40,tickStepValue:null,font:{},categories:[],labelPosition:"middle",placement:"auto",gridLines:{}},m.defaultYAxis={title:{text:"",font:{}},min:void 0,max:void 0,tickStep:40,tickStepValue:null,font:{},labelFormat:"number",labelFormatter:void 0,labelPrefix:void 0,labelSuffix:void 0,currencySymbol:"£",placement:"auto",type:"linear",gridLines:{}},m.defaultPrimaryYAxis=a({},[m.defaultYAxis,{gridLines:{colour:"#ccc"}}]),m.defaultSecondaryYAxis=m.defaultYAxis,m.presets={histogram:{barPlot:{mode:"overlaid",categorySpacing:0,barPadding:1}},darkGrid:{allAxes:{gridLines:{colour:"rgba(255, 255, 255, 0.6)"}},plotBackgroundColour:"#E5E5E5"}},m.defaultColours=["#6FE87B","#FFAB51","#51A8FF","#B651FF","#FF6051","#636363","#FFE314","#A88572","#B7B7B7"],m.mapVerticalPosition=function(t,e){switch(e){case"outside":return t>0?"bottom":"top";case"inside":return t>0?"top":"bottom";default:return"middle"}},m.prototype.mapLogicalXUnit=function(t){return this.scaleFactorX*t},m.prototype.mapLogicalYUnit=function(t){return this.scaleFactorY*t},m.prototype.mapScreenUnit=function(t){return t/this.scaleFactor},m.prototype.calculatePlotArea=function(){var t=this,e=5;this.plotArea=new P(0,0,this.labelsCanvas.width,this.labelsCanvas.height),this.options.title.text&&(this.plotArea.top+=this.mapLogicalYUnit(this.options.elementSmallPadding),this.plotArea.top+=this.getFontHeight(this.options.title.font)*this.getMultilineTextHeight(this.titleFont,this.labelsCanvas.width,this.options.title.text)),this.options.legend.enabled&&(this.plotArea.bottom-=this.mapLogicalYUnit(this.options.elementSmallPadding+this.options.elementLargePadding+this.options.legend.indicatorSize)),this.yAxes.map(function(e){return e.adjustSize(t.plotArea,!0,!0)}),this.xAxes.map(function(e){return e.adjustSize(t.plotArea,!0,!0)});for(var i=0;e>i&&(this.yAxes.map(function(t){return t.calculateExtent()}),this.xAxes.map(function(t){return t.calculateExtent()}),this.yAxes.map(function(t){return t.updateFormatter()}),this.xAxes.map(function(t){return t.updateFormatter()}),!n(this.yAxes.map(function(e){return e.adjustSize(t.plotArea)}))||!n(this.xAxes.map(function(e){return e.adjustSize(t.plotArea)})));i++);this.plotArea.left=Math.ceil(this.plotArea.left),this.plotArea.top=Math.ceil(this.plotArea.top),this.plotArea.right=Math.floor(this.plotArea.right),this.plotArea.bottom=Math.floor(this.plotArea.bottom)},m.prototype.hitTest=function(t,e){for(var i={found:!1},s=[],n=0;n<this.renderers.length;n++){var o=this.renderers[n].hitTest(t,e);o.found&&s.push(o)}return s.push(this.hitTestLegend(t,e)),s.length&&(s.sort(function(t,e){return!t.found-!e.found||t.normalisedDistance-e.normalisedDistance}),i=s[0]),i},m.prototype.drawLegend=function(){if(this.options.legend.enabled){var t=this.getLegendMeasurements();this.labelsCtx.save(),this.labelsCtx.font=this.legendFont;for(var e=0;e<t.items.length;e++){var i=t.items[e],s=i.series,n="legend"===this.selectedItem.type&&this.selectedItem.data.series===s;s.renderer.drawLegendIndicator(this.labelsCtx,s,i.indicatorRect,n),this.labelsCtx.textBaseline="middle",this.labelsCtx.fillStyle=this.options.legend.font.colour,s.visible&A.visible||(this.labelsCtx.fillStyle=new C(this.labelsCtx.fillStyle).multiplyAlpha(this.options.legend.hiddenAlphaMultiplier).toString()),this.labelsCtx.fillText(s.name,i.textX,i.textY)}this.labelsCtx.restore()}},m.prototype.hitTestLegend=function(t,e){var i={found:!1,type:"legend"},s=this.getLegendMeasurements();if(s.rect.containsPoint(t,e))for(var n=0;n<s.items.length;n++){var a=s.items[n];if(a.rect.containsPoint(t,e)){o(i,[{found:!0,normalisedDistance:-5,data:a}]);break}}return i},m.prototype.getLegendMeasurements=function(){var t={rect:new P(0),items:[]};if(this.options.legend.enabled){for(var e=this.mapLogicalXUnit(this.options.elementSmallPadding),i=this.mapLogicalXUnit(this.options.elementLargePadding),s=0,n=this.mapLogicalXUnit(this.options.legend.indicatorSize),o=0;o<this.options.series.length;o++){var a=this.options.series[o],r=0;a.name&&(r=this.getTextWidth(a.name,this.legendFont),s+=r+n+e+i,t.items.push({textWidth:r,series:a}))}var l=this.plotArea.left+this.plotArea.width/2-s/2,h=this.labelsCanvas.height-n;t.rect.left=l,t.rect.right=l+s,t.rect.top=h,t.rect.bottom=h+n;for(var o=0;o<t.items.length;o++){var u=t.items[o];u.rect=new P(l,t.rect.top,l+n+e+u.textWidth,t.rect.bottom),u.indicatorRect=new P(l,t.rect.top,l+n,t.rect.bottom),l+=n+e,u.textX=l,u.textY=h+n/2,l+=t.items[o].textWidth+i}}return t},m.prototype.revokeAnimation=function(t){for(var e=this.pendingAnimations.length;e;e--)this.pendingAnimations[e-1].series===t&&this.pendingAnimations.splice(e-1,1)},m.prototype.startAnimation=function(t){t.initialStage=t.initialStage||0;var e=o({},[{length:500*(1-t.initialStage),startTime:"undefined"!=typeof performance&&"undefined"!=typeof performance.now?performance.now():null},t]);return this.pendingAnimations.push(e),this.animator||(this.animator=requestAnimationFrame(this.onAnimate.bind(this))),e},m.prototype.onAnimate=function(t){for(var e,i=this.pendingAnimations.length-1;i>=0;i--){var s=this.pendingAnimations[i];null===s.startTime&&(s.startTime=t),e=t-s.startTime,s.onFrame&&s.onFrame(s.initialStage+Math.min(e/s.length,1)*(1-s.initialStage)),e>=s.length&&(this.pendingAnimations.splice(i,1),s.onCompletion&&s.onCompletion())}for(var n=0;n<this.renderers.length;n++)this.renderers[n].onAnimationFrame();this.redraw(!0),this.pendingAnimations.length?this.animator=requestAnimationFrame(this.onAnimate.bind(this)):this.animator=null},m.prototype.setSeriesVisibility=function(t,e,i){if(t.visible=e?A.visible:A.hidden,t.visible|=A.transitioning,t.animationState){var s=e?"show":"hide";t.animationState.type!==s&&(t.animationState.type=s,t.animationState.stage=1-t.animationState.stage,delete t.animationState.animator,this.revokeAnimation(t))}else t.animationState={type:t.visible&A.visible?"show":"hide",subtype:i,stage:0};t.animationState.animator||(t.animationState.animator=this.startAnimation({type:e?"showSeries":"hideSeries",series:t,initialStage:t.animationState.stage,onFrame:function(e){return t.animationState.stage=e},onCompletion:function(){t.visible=t.visible&~A.transitioning,delete t.animationState}}))},m.prototype.toggleSeriesVisibility=function(t){this.setSeriesVisibility(t,!(t.visible&A.visible))};var Y={create:function(t,e){var i=new m;i.create(t),i.setOptions(e),i.render()}};return Y});
//# sourceMappingURL=tayberry.min.js.map
