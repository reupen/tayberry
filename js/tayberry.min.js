!function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var e;e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,e.Tayberry=t()}}(function(){return function t(e,i,s){function n(r,a){if(!i[r]){if(!e[r]){var l="function"==typeof require&&require;if(!a&&l)return l(r,!0);if(o)return o(r,!0);var h=new Error("Cannot find module '"+r+"'");throw h.code="MODULE_NOT_FOUND",h}var u=i[r]={exports:{}};e[r][0].call(u.exports,function(t){var i=e[r][1][t];return n(i?i:t)},u,u.exports,t,e,i,s)}return i[r].exports}for(var o="function"==typeof require&&require,r=0;r<s.length;r++)n(s[r]);return n}({1:[function(t,e,i){"use strict";function s(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var n=function(){function t(t,e){for(var i=0;i<e.length;i++){var s=e[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}return function(e,i,s){return i&&t(e.prototype,i),s&&t(e,s),e}}(),o=t("./utils.js"),r=function(){function t(){if(s(this,t),1===arguments.length){var e=arguments[0];"string"==typeof e?this.parseString(e):(this.r=e.r,this.g=e.g,this.b=e.b,this.a=e.a)}}return n(t,[{key:"parseString",value:function(t){var e=/^#?([0-9A-F]{2})([0-9A-F]{2})([0-9A-F]{2})|^#?([0-9A-F]{1})([0-9A-F]{1})([0-9A-F]{1})$/i,i=/^rgba?\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})(\s*,\s*([0-9]*\.?[0-9]+)\s*)?\)$/i,s=e.exec(t),n=i.exec(t);if(s){var o=function(t){var e=parseInt(t,16);return e=16*e+e};this.r=s[1]?parseInt(s[1],16):o(s[4]),this.g=s[2]?parseInt(s[2],16):o(s[5]),this.b=s[3]?parseInt(s[3],16):o(s[6]),this.a=null}else{if(!n)throw new RangeError(t+" is not a valid HTML colour");this.r=parseInt(n[1]),this.g=parseInt(n[2]),this.b=parseInt(n[3]),this.a=n[5]?parseFloat(n[5]):null}return this}},{key:"clipComponent",value:function(t){return this[t]=Math.round(this[t]),this[t]=Math.min(this[t],255),this[t]=Math.max(this[t],0),this}},{key:"clip",value:function(){return this.clipComponent("r"),this.clipComponent("g"),this.clipComponent("b"),this}},{key:"increaseBy",value:function(t){return this.r+=t,this.g+=t,this.b+=t,this.clip(),this}},{key:"toString",value:function(){var t;return t=this.a?o.formatString("rgba({r},{g},{b},{a})",this):o.formatString("rgb({r},{g},{b})",this)}},{key:"sum",get:function(){return this.r+this.g+this.b}}]),t}();i.Colour=r},{"./utils.js":12}],2:[function(t,e,i){"use strict";i.linear=function(t,e){return t/e},i.linear=function(t,e){return t/e},i.inQuad=function(t,e){var i=t/e;return i*i},i.outQuad=function(t,e){var i=t/e;return i*(2-i)}},{}],3:[function(t,e,i){"use strict";function s(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var n=function(){function t(t,e){for(var i=0;i<e.length;i++){var s=e[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}return function(e,i,s){return i&&t(e.prototype,i),s&&t(e,s),e}}(),o=function(){function t(){s(this,t);var e;1===arguments.length?(e=arguments[0],this.left=e.left,this.top=e.top,this.right=e.right,this.bottom=e.bottom):4===arguments.length&&(this.left=arguments[0],this.top=arguments[1],this.right=arguments[2],this.bottom=arguments[3])}return n(t,[{key:"containsPoint",value:function(t,e){return this.containsX(t)&&this.containsY(e)}},{key:"containsY",value:function(t){return t>=this.top&&t<this.bottom||t>=this.bottom&&t<this.top}},{key:"containsX",value:function(t){return t>=this.left&&t<this.right||t>=this.right&&t<this.left}},{key:"clip",value:function(t){return this.left<t.minX?this.left=t.minX:this.left>t.maxX&&(this.left=t.maxX),this.right<t.minX?this.right=t.minX:this.right>t.maxX&&(this.right=t.maxX),this.top<t.minY?this.top=t.minY:this.top>t.maxY&&(this.top=t.maxY),this.bottom>t.maxY?this.bottom=t.maxY:this.bottom<t.minY&&(this.bottom=t.minY),this}},{key:"clone",value:function(){return new t(this)}},{key:"swapXY",value:function(){var t=[this.top,this.left];this.left=t[0],this.top=t[1];var e=[this.right,this.bottom];return this.bottom=e[0],this.right=e[1],this}},{key:"width",get:function(){return this.right-this.left}},{key:"height",get:function(){return this.bottom-this.top}},{key:"maxY",get:function(){return Math.max(this.bottom,this.top)}},{key:"minY",get:function(){return Math.min(this.bottom,this.top)}},{key:"minX",get:function(){return Math.min(this.left,this.right)}},{key:"maxX",get:function(){return Math.max(this.left,this.right)}}]),t}();i.Rect=o},{}],4:[function(t,e,i){"use strict";function s(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var o=function(){function t(t,e){var i=[],s=!0,n=!1,o=void 0;try{for(var r,a=t[Symbol.iterator]();!(s=(r=a.next()).done)&&(i.push(r.value),!e||i.length!==e);s=!0);}catch(l){n=!0,o=l}finally{try{!s&&a["return"]&&a["return"]()}finally{if(n)throw o}}return i}return function(e,i){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return t(e,i);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),r=function(t,e,i){for(var s=!0;s;){var n=t,o=e,r=i;a=h=l=void 0,s=!1,null===n&&(n=Function.prototype);var a=Object.getOwnPropertyDescriptor(n,o);if(void 0!==a){if("value"in a)return a.value;var l=a.get;return void 0===l?void 0:l.call(r)}var h=Object.getPrototypeOf(n);if(null===h)return void 0;t=h,e=o,i=r,s=!0}},a=function(){function t(t,e){for(var i=0;i<e.length;i++){var s=e[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}return function(e,i,s){return i&&t(e.prototype,i),s&&t(e,s),e}}(),l=t("./utils.js"),h=function(){function t(e,i,s,o){n(this,t),this.tayberry=e,this.options=s,this.axisType=o,this.index=i,this.tickStep=null,this.min=null,this.max=null,this.tickStart=null,this.tickEnd=null,this.calculatedSize=0,this.topAdjustment=0,this.rightAdjustment=0,this.titleFont=null,this.labelFont=null,this.numLabelLines=1,this.setPlacement()}return a(t,null,[{key:"create",value:function(t,e,i,s,n){return n&&(s="y"===s?"x":"y"),"linear"===e.type?new c(t,i,e,s):new u(t,i,e,s)}}]),a(t,[{key:"updateFonts",value:function(){this.labelFont=this.tayberry.createFontString(this.options.font),this.titleFont=this.tayberry.createFontString(this.options.title.font)}},{key:"setPlacement",value:function(){var t=["left","right","top","bottom","start","end"];-1===t.indexOf(this.options.placement)&&(this.options.placement=this.isYAxis^this.index>0?"start":"end")}},{key:"maxLabelSize",value:function(){var t=this,e=this.tayberry,i=this.getTicks();return l.reduce(i,Math.max,function(i){return e.getTextWidth(t.options.labelFormatter(i.value),t.labelFont)})}},{key:"mapLogicalXOrYUnit",value:function(t){return this.isYAxis?this.tayberry.mapLogicalXUnit(t):this.tayberry.mapLogicalYUnit(t)}},{key:"mapLogicalYOrXUnit",value:function(t){return this.isYAxis?this.tayberry.mapLogicalYUnit(t):this.tayberry.mapLogicalXUnit(t)}},{key:"adjustSize",value:function(t,e,i){var s=0,n=this.tayberry,o=void 0,r=n.getFontHeight(this.options.title.font),a=n.getFontHeight(this.options.font);if(i&&(this.calculatedSize=0,this.topAdjustment=0,this.rightAdjustment=0,this.numLabelLines=1),s+=this.mapLogicalXOrYUnit(n.options.elementSmallPadding),this.options.title.text&&(s+=this.mapLogicalXOrYUnit(n.options.elementSmallPadding)+r),!e){var l=this.getTicks(!1);if(this.isYAxis){if(l.length){var h=l[l.length-1],u=h.y-a/2;if(u<t.top-this.topAdjustment){var c=t.top-u-this.topAdjustment+1;t.top+=c,this.topAdjustment+=c}}s+=this.maxLabelSize()}else{for(var p=void 0,d=0;d<l.length;d++){var f=l[d],m=n.getTextWidth(this.options.labelFormatter(f.value),this.labelFont),g=f.x-m/2,y=f.x+m/2;if("undefined"!=typeof p&&p+1>=g){this.numLabelLines=2;break}p=y}if(l.length){var h=l[l.length-1],m=n.getTextWidth(this.options.labelFormatter(h.value),this.labelFont),b=h.x+m/2;if(b>=t.right+this.rightAdjustment){var c=b-t.right-this.rightAdjustment+1;t.right-=c,this.rightAdjustment+=c}}s+=a*this.numLabelLines}}return this.isPlacedAtStart?this.isYAxis?t.left+=s-this.calculatedSize:t.top+=s-this.calculatedSize:(s*=-1,this.isYAxis?t.right+=s-this.calculatedSize:t.bottom+=s-this.calculatedSize),o=this.calculatedSize!==s,this.calculatedSize=s,o}},{key:"calculateExtent",value:function(){}},{key:"getCategoryLabel",value:function(){}},{key:"draw",value:function(){this.drawTicksAndLabels(),this.drawTitle()}},{key:"drawTicksAndLabels",value:function(){var t=this.tayberry,e=this.isYAxis?this.mapLogicalXOrYUnit(t.options.elementSmallPadding)*(this.isPlacedAtStart?-1:1):0,i=this.isYAxis?0:this.mapLogicalXOrYUnit(t.options.elementSmallPadding)*(this.isPlacedAtStart?-1:1),s=t.getFontHeight(this.options.font);t.labelsCtx.save(),t.labelsCtx.font=this.labelFont,t.labelsCtx.fillStyle=this.options.font.colour,t.labelsCtx.textAlign=this.isYAxis?this.isPlacedAtStart?"right":"left":"center",t.labelsCtx.textBaseline=this.isYAxis?"middle":this.isPlacedAtStart?"bottom":"top";var n=[],o=0;this.enumerateTicks(function(r){var a=void 0,l=void 0,h=void 0,u=this.options.labelFormatter(r.value),c=o%this.numLabelLines,p=this.isYAxis?0:s*c;this.isYAxis||(a=t.getTextWidth(u,this.labelFont),l=r.x-a/2,h=r.x+a/2),(this.isYAxis||("undefined"==typeof n[c]||l>n[c]+1)&&l>=0&&h<t.labelsCanvas.width)&&(t.labelsCtx.fillText(u,r.x+e,r.y+i+p),n[c]=h),this.options.gridLines.colour&&t.drawLine(r.x1,r.y1,r.x2,r.y2,this.options.gridLines.colour),o++}.bind(this)),t.labelsCtx.restore()}},{key:"drawTitle",value:function(){if(this.options.title.text){var t=this.tayberry;if(t.labelsCtx.save(),t.labelsCtx.font=this.titleFont,t.labelsCtx.fillStyle=this.options.title.font.colour,t.labelsCtx.textAlign="center",t.labelsCtx.textBaseline=this.isPlacedAtStart?"top":"bottom",this.isYAxis){var e=0,i=t.plotArea.top+t.plotArea.height/2;t.labelsCtx.translate(e,i),t.labelsCtx.rotate(-Math.PI/2),t.labelsCtx.fillText(this.options.title.text,0,0)}else{var e=t.plotArea.left+t.plotArea.width/2,i=t.plotArea[this.startProperty]-this.calculatedSize;t.labelsCtx.fillText(this.options.title.text,e,i)}t.labelsCtx.restore()}}},{key:"getTicks",value:function(){var t=arguments.length<=0||void 0===arguments[0]?!0:arguments[0],e=[];return this.enumerateTicks(function(t){e.push(t)},t),e}},{key:"getOrigin",value:function(){}},{key:"updateFormatter",value:function(){}},{key:"isPlacedAtStart",get:function(){return"left"===this.options.placement||"bottom"===this.options.placement||"start"===this.options.placement}},{key:"isYAxis",get:function(){return"y"===this.axisType}},{key:"startProperty",get:function(){return this.isYAxis?this.isPlacedAtStart?"left":"right":this.isPlacedAtStart?"top":"bottom"}},{key:"endProperty",get:function(){return this.isYAxis?this.isPlacedAtStart?"right":"left":this.isPlacedAtStart?"bottom":"top"}}]),t}(),u=function(t){function e(){n(this,e),r(Object.getPrototypeOf(e.prototype),"constructor",this).apply(this,arguments)}return s(e,t),a(e,[{key:"enumerateTicks",value:function(t){var e=this.tayberry,i=this.options.categories.length,s=e.plotArea.clone();this.isYAxis&&s.swapXY();var n=s.width/e.series[0].data.length,o=.5;if(!this.isYAxis)switch(this.options.labelPosition){case"left":o=0;break;case"right":o=1}for(var r=0;i>r;r++){var a=this.options.categories[r],l=this.isPlacedAtStart?s.top:s.bottom,h=this.isPlacedAtStart?s.bottom:s.top,u=s.left+Math.floor(r*n),c=u,p=s.left+Math.floor(r*n+n*o),d=l;if(this.isYAxis){var f=[l,u,h,c,d,p];u=f[0],l=f[1],c=f[2],h=f[3],p=f[4],d=f[5]}t({value:a,x1:u,y1:l,x2:c,y2:h,x:p,y:d})}}},{key:"updateFormatter",value:function(){this.options.labelFormatter||(this.options.labelFormatter=l.identity)}},{key:"getCategoryLabel",value:function(t){return this.options.labelFormatter(this.options.categories[t])}}]),e}(h),c=function(t){function e(){n(this,e),r(Object.getPrototypeOf(e.prototype),"constructor",this).apply(this,arguments)}return s(e,t),a(e,[{key:"updateFormatter",value:function(){this.options.labelFormatter||("percentage"===this.options.labelFormat?this.options.labelFormatter=l.createPercentageFormatter(this.max-this.min,this.options.labelPrefix,this.options.labelSuffix):"currency"===this.options.labelFormat?this.options.labelFormatter=l.createFixedNumberFormatter(this.max-this.min,this.options.labelPrefix||this.options.currencySymbol,this.options.labelSuffix):this.options.labelFormatter=l.createAutoNumberFormatter(this.max-this.min,this.options.labelPrefix,this.options.labelSuffix))}},{key:"enumerateTicks",value:function(t){for(var e=this.tayberry,i=this.startProperty,s=this.endProperty,n=this.tickStart;n<=this.tickEnd&&this.tickStep;){var o=this.getValueDisplacement(n);if(this.isYAxis){if(t({value:n,x1:e.plotArea[i],y1:o,x2:e.plotArea[s],y2:o,x:e.plotArea[i],y:o}))break}else if(t({value:n,y1:e.plotArea[i],x1:o,y2:e.plotArea[s],x2:o,y:e.plotArea[i],x:o}))break;n=this.tickStart+Math.round((n+this.tickStep-this.tickStart)/this.tickStep)*this.tickStep}}},{key:"calculateExtent",value:function(){var t=void 0,i=void 0,s=void 0,n=this.options.min,r=this.options.max,a=!l.isMissingValue(n),h=!l.isMissingValue(r);if(!a||!h){var u=this.tayberry.getDataMinMax(),c=o(u,2),p=c[0],d=c[1],f=d-p;a||(n=p-.1*f,p>=0&&0>n&&(n=0)),h||(r=d+.1*f,0>=d&&n>0&&(r=0))}if(this.options.tickStepValue)this.tickStep=this.options.tickStepValue,this.min=n,this.max=r;else{var m=r-n;t=this.plotLength/this.mapLogicalYOrXUnit(this.options.tickStep),i=m/t,s=Math.pow(10,Math.floor(Math.log(i)/Math.log(10)));var g=e.snapScaledValue(Math.ceil(i/s));this.tickStep=g*s,this.min=n,this.max=r}this.tickStart=this.options.tickStepValue&&a?this.min:Math.floor(this.min/this.tickStep)*this.tickStep,this.tickEnd=this.options.tickStepValue&&h?this.max:Math.ceil(this.max/this.tickStep)*this.tickStep,a||(this.min=this.tickStart),h||(this.max=this.tickEnd)}},{key:"getOrigin",value:function(){var t=this.tayberry.plotArea[this.isYAxis?"bottom":"left"]-(0-this.min)*this.plotDisplacement/(this.max-this.min);return this.isYAxis&&t--,t=this.isYAxis?Math.floor(t):Math.ceil(t)}},{key:"getValueDisplacement",value:function(t){var e=this.getOrigin()-t*this.plotDisplacement/(this.max-this.min);return e=this.isYAxis?Math.floor(e):Math.ceil(e)}},{key:"getCategoryLabel",value:function(t,e){var i=t/e,s=(t+1)/e,n=this.max-this.min;return l.formatString("{0} ≤ x < {1}",[this.options.labelFormatter(this.min+i*n),this.options.labelFormatter(this.min+s*n)])}},{key:"plotDisplacement",get:function(){return this.isYAxis?this.tayberry.plotArea.height-1:-(this.tayberry.plotArea.width-1)}},{key:"plotLength",get:function(){return Math.abs(this.plotDisplacement)}}],[{key:"snapScaledValue",value:function(t){return t=1>t?1:2>t?2:2.5>t?2.5:5>t?5:10}}]),e}(h);i.Axis=h},{"./utils.js":12}],5:[function(t,e,i){"use strict";function s(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var n=function(){function t(t,e){for(var i=0;i<e.length;i++){var s=e[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}return function(e,i,s){return i&&t(e.prototype,i),s&&t(e,s),e}}(),o=function(){function t(){s(this,t),this.selectedItem={},this.containerElement=null,this.labelsCanvas=null,this.labelsCtx=null,this.renderedSeries=null,this.options=null,this.scaleFactor=null,this.titleFont=null,this.plotArea=null,this.series=[],this.categories=[],this.titleFont=null,this.labelFont=null,this.legendFont=null}return n(t,[{key:"seriesCount",get:function(){return this.series.length}},{key:"categoryCount",get:function(){return this.series.length?this.series[0].data.length:0}}]),t}();i.Tayberry=o},{}],6:[function(t,e,i){"use strict";var s=t("./colour").Colour,n=t("./utils"),o=t("./tayberry.base").Tayberry,r=t("./tayberry.axes").Axis,a=0;o.getAutoColour=function(){var t=o.defaultColours[a%o.defaultColours.length];return a++,t},o.prototype.createCanvas=function(){var t=document.createElement("canvas");return t.style.width=Math.floor(this.containerElement.clientWidth)+"px",t.style.width=Math.floor(this.containerElement.clientWidth)+"px",t.style.height=Math.floor(this.containerElement.clientHeight)+"px",t.style.position="absolute",this.containerElement.appendChild(t),t},o.prototype.create=function(t){"string"==typeof t?this.containerElement=document.getElementById(t):this.containerElement=t,this.labelsCanvas=this.createCanvas(),this.labelsCtx=this.labelsCanvas.getContext("2d"),this.plotCanvas=this.createCanvas(),this.plotCtx=this.plotCanvas.getContext("2d"),this.renderedSeries=null,this.options={},this.yAxis=null,this.xAxis=null,this.initialise()},o.prototype.destroy=function(){this.labelsCanvas.parentNode.removeChild(this.labelsCanvas),this.tooltipElement.parentNode.removeChild(this.tooltipElement),this.options={},this.series={},this.plotCanvas.removeEventListener("mousemove",this.onMouseMoveReal),this.plotCanvas.removeEventListener("mouseleave",this.onMouseLeaveReal),window.removeEventListener("resize",this.onWindowResizeReal)},o.prototype.initialise=function(){this.scaleFactor=window.devicePixelRatio||1,this.labelsCanvas.width=Math.round(this.labelsCanvas.clientWidth*this.scaleFactor),this.labelsCanvas.height=Math.round(this.labelsCanvas.clientHeight*this.scaleFactor),this.plotCanvas.width=this.labelsCanvas.width,this.plotCanvas.height=this.labelsCanvas.height,this.scaleFactorX=this.labelsCanvas.width/this.labelsCanvas.clientWidth,this.scaleFactorY=this.labelsCanvas.height/this.labelsCanvas.clientHeight,this.selectedItem={},this.plotArea=null},o.prototype.getFontHeight=function(t,e){var i=t.size;return t.autoScale&&(i*=Math.pow(this.labelsCanvas.width/800,.25)),e||(i=this.mapLogicalYUnit(i)),i},o.prototype.createFontString=function(t,e){return(t.style?t.style+" ":"")+this.getFontHeight(t,e).toFixed(1)+"px "+t.face},o.prototype.updateFonts=function(){this.titleFont=this.createFontString(this.options.title.font),this.labelFont=this.createFontString(this.options.labels.font),this.legendFont=this.createFontString(this.options.legend.font),this.yAxis.updateFonts(),this.xAxis.updateFonts()},o.prototype.setOptions=function(t){var e=[this.defaultOptions()];if(t.presets)for(var i=0;i<t.presets.length;i++)e.push(o.presets[t.presets[i]]);e.push(t),this.options=n.deepAssign({},e),this.options.title.font=n.deepAssign({},[this.options.font,this.options.title.font]),this.options.tooltips.font=n.deepAssign({},[this.options.font,this.options.tooltips.font]),this.options.labels.font=n.deepAssign({},[this.options.font,this.options.labels.font]),this.options.legend.font=n.deepAssign({},[this.options.font,this.options.legend.font]),this.options.yAxis.title.font=n.deepAssign({},[this.options.font,this.options.allAxes.title.font,this.options.yAxis.title.font]),this.options.xAxis.title.font=n.deepAssign({},[this.options.font,this.options.allAxes.title.font,this.options.xAxis.title.font]),this.options.xAxis.font=n.deepAssign({},[this.options.font,this.options.allAxes.font,this.options.xAxis.font]),this.options.yAxis.font=n.deepAssign({},[this.options.font,this.options.allAxes.font,this.options.yAxis.font]),this.setSeries(t.series),this.yAxis=r.create(this,this.options.yAxis,0,"y",this.options.swapAxes),this.xAxis=r.create(this,this.options.xAxis,0,"x",this.options.swapAxes),this.updateFonts(),this.plotCanvas.addEventListener("mousemove",this.onMouseMoveReal=this.onMouseMove.bind(this)),this.plotCanvas.addEventListener("mouseleave",this.onMouseLeaveReal=this.onMouseLeave.bind(this)),window.addEventListener("resize",this.onWindowResizeReal=n.throttle(this.onWindowResize,50).bind(this))},o.calculateHighlightColour=function(t){var e=new s(t);return e.increaseBy(30*(e.sum>=540?-1:1)).toString()},o.prototype.setSeries=function(t){var e;for(Array.isArray(t)?this.series=t:this.series=[t],this.renderedSeries=t.slice(0),e=0;e<this.renderedSeries.length;e++){var i=this.series[e];i.colour=i.colour||o.getAutoColour(),i.highlightColour=i.highlightColour||o.calculateHighlightColour(i.colour);var s=n.assign({},i);s.data=this.renderedSeries[e].data.slice(0),this.renderedSeries[e]=s}},o.prototype.getDataMinMax=function(){var t,e,i,s,o=[],r=[],a=[],l=[];if(this.series[0].data.length){for(t=0;t<this.series[0].data.length;t++)for(o[t]=0,r[t]=0,e=0;e<this.series.length;e++){var h=this.series[e].data[t];n.isMissingValue(h)||(0>h?r[t]+=h:o[t]+=h)}for(var u=0;u<this.series.length;u++){var c=this.series[u];a.push(n.reduce(c.data,Math.min,void 0,!0)),l.push(n.reduce(c.data,Math.max,void 0,!0))}"stacked"===this.options.barMode?(i=Math.min(0,n.reduce(r,Math.min,void 0,!0)),s=Math.max(n.reduce(o,Math.max,void 0,!0),0)):(i=n.reduce(a,Math.min,void 0,!0),s=n.reduce(l,Math.max,void 0,!0))}return[i,s]},o.prototype.createTooltip=function(){this.tooltipElement&&(this.tooltipElement.parentNode.removeChild(this.tooltipElement),this.tooltipElement=null),this.tooltipElement=document.createElement("div"),this.tooltipElement.className="tayberry-tooltip",this.tooltipElement.style.position="absolute",this.tooltipElement.style.left="0px",this.tooltipElement.style.top="0px",this.tooltipElement.style.zIndex="99999",this.tooltipElement.style.font=this.createFontString(this.options.tooltips.font,!0),this.tooltipElement.style.borderRadius="3px",this.tooltipElement.style.backgroundColor="white",this.tooltipElement.style.border="2px solid #bbb",this.tooltipElement.style.padding="0.15em 0.4em",this.tooltipElement.style.display="none",this.tooltipElement.innerHTML="",document.body.appendChild(this.tooltipElement),this.tooltipElement.addEventListener("mousemove",this.onMouseMove.bind(this)),this.tooltipElement.addEventListener("mouseleave",this.onMouseLeave.bind(this))}},{"./colour":1,"./tayberry.axes":4,"./tayberry.base":5,"./utils":12}],7:[function(t,e,i){"use strict";var s=t("./tayberry.base.js").Tayberry;s.prototype.defaultOptions=function(){return{title:{text:"",font:{size:20}},font:{colour:"#444",size:12,face:"sans-serif",style:"",autoScale:!0},allAxes:{font:{},title:{font:{}}},xAxis:{title:{text:"",font:{}},type:"categorial",min:null,max:null,tickStep:40,tickStepValue:null,font:{},categories:[],labelPosition:"middle",placement:"auto",gridLines:{}},yAxis:{title:{text:"",font:{}},gridLines:{colour:"#ccc"},min:void 0,max:void 0,tickStep:40,tickStepValue:null,font:{},labelFormat:"number",labelFormatter:void 0,labelPrefix:void 0,labelSuffix:void 0,currencySymbol:"£",placement:"auto",type:"linear"},animations:{enabled:!0},series:[],swapAxes:!1,barMode:"normal",barPadding:2,elementSmallPadding:5,elementLargePadding:10,categorySpacing:.3,presets:[],tooltips:{shared:!1,headerTemplate:"<strong>{category}</strong><table>",valueTemplate:'<tr><td style="padding-right: 0.5em"><span style="color: {colour}">●</span> {name}</td><td style="text-align: right">{value}</td></tr>',footerTemplate:"</table>",font:{}},legend:{enabled:!0,indicatorSize:15,font:{}},labels:{enabled:!1,verticalAlignment:"top",verticalPosition:"outside",font:{}}}},s.presets={histogram:{xAxis:{labelPosition:"left"},barMode:"overlaid",categorySpacing:0,barPadding:1}},s.defaultColours=["#6FE87B","#FFAB51","#51A8FF","#B651FF","#FF6051","#636363","#FFE314","#A88572","#B7B7B7"]},{"./tayberry.base.js":5}],8:[function(t,e,i){"use strict";var s=t("./tayberry.base.js").Tayberry;t("./utils");s.prototype.getTextWidth=function(t,e){var i=void 0;return e&&(this.labelsCtx.save(),this.labelsCtx.font=e),i=this.labelsCtx.measureText(t).width,e&&this.labelsCtx.restore(),i},s.prototype.getMultilineTextHeight=function(t,e,i){var s=void 0;return t&&(this.labelsCtx.save(),this.labelsCtx.font=t),s=this.splitMultilineText(e,i).length,t&&this.labelsCtx.restore(),s},s.prototype.splitMultilineText=function(t,e){for(var i=[],s=0,n="",o=this.labelsCtx.measureText(" ").width,r=0;r<e.length;){for(var a=r;r<e.length&&" "!==e[r]&&"\r"!==e[r]&&"\n"!==e[r];)r++;for(var l=r;r<e.length&&(" "===e[r]||"\r"===e[r]||"\n"===e[r]);)r++;if(l>a){var h=e.substring(a,l),u=this.labelsCtx.measureText(h).width;s+u>t?(s||(n=h),i.push(n),s&&(s=0,n=h)):(n+=(n?" ":"")+h,s+=u+o)}}return n&&i.push(n),i},s.prototype.drawTextMultiline=function(t,e,i,s,n){for(var o=this.splitMultilineText(s,n),r=0;r<o.length;r++){var a=o[r];this.labelsCtx.fillText(a,e,i+t*r)}},s.prototype.render=function(){this.calculatePlotArea(),this.drawTitle(),this.xAxis.draw(),this.yAxis.draw(),this.drawLegend(),this.createTooltip(),this.options.animations.enabled?(this.animator=requestAnimationFrame(this.onAnimate.bind(this)),this.animationStart="undefined"!=typeof performance&&"undefined"!=typeof performance.now?performance.now():null,this.animationLength=500):this.draw()},s.prototype.clear=function(){var t=arguments.length<=0||void 0===arguments[0]?!0:arguments[0],e=arguments.length<=1||void 0===arguments[1]?!0:arguments[1];t&&this.plotCtx.clearRect(0,0,this.plotCanvas.width,this.plotCanvas.height),e&&this.labelsCtx.clearRect(0,0,this.labelsCanvas.width,this.labelsCanvas.height)},s.prototype.drawTitle=function(){if(this.options.title.text){var t=this.labelsCanvas.width/2,e=0;this.labelsCtx.save(),this.labelsCtx.textAlign="center",this.labelsCtx.textBaseline="top",this.labelsCtx.font=this.titleFont,this.labelsCtx.fillStyle=this.options.title.font.colour,this.drawTextMultiline(this.getFontHeight(this.options.title.font),t,e,this.labelsCanvas.width,this.options.title.text),this.labelsCtx.restore()}},s.prototype.drawLabel=function(t,e,i){this.options.swapAxes&&(i=i.clone().swapXY());var n=(i.left+i.right)/2,o=void 0;o="top"===this.options.labels.verticalAlignment?i.top:"bottom"===this.options.labels.verticalAlignment?i.bottom:(i.top+i.bottom)/2;var r="middle",a="center";if(this.options.swapAxes){var l=[o,n];n=l[0],o=l[1],"outside"===this.options.labels.verticalPosition?a="left":"inside"===this.options.labels.verticalPosition&&(a="right")}else r=s.mapVerticalPosition(t,this.options.labels.verticalPosition);this.plotArea.containsPoint(n,o)&&(this.plotCtx.save(),this.plotCtx.textAlign=a,this.plotCtx.textBaseline=r,this.plotCtx.fillText(e,n,o),this.plotCtx.restore())},s.prototype.draw=function(){this.plotCtx.save(),this.enumerateBars(function(t){this.plotCtx.fillStyle=t.selected?t.renderedSeries.highlightColour:t.renderedSeries.colour,this.plotCtx.fillRect(t.rect.left,t.rect.top,t.rect.width,t.rect.height)}.bind(this)),this.plotCtx.restore(),this.options.labels.enabled&&(this.plotCtx.save(),this.enumerateBars(function(t){this.plotCtx.font=this.labelFont,this.plotCtx.fillStyle=this.options.labels.font.colour,this.drawLabel(t.value,this.options.yAxis.labelFormatter(t.value),t.rect)}.bind(this)),this.plotCtx.restore())},s.prototype.drawLine=function(t,e,i,s,n){this.labelsCtx.save(),n&&(this.labelsCtx.strokeStyle=n),this.labelsCtx.beginPath(),this.labelsCtx.moveTo(t+.5,e+.5),this.labelsCtx.lineTo(i+.5,s+.5),this.labelsCtx.stroke(),this.labelsCtx.restore()},s.prototype.redraw=function(t){this.clear(!0,!t),t||(this.drawTitle(),this.xAxis.draw(),this.yAxis.draw(),this.drawLegend()),this.draw()},s.prototype.drawLegend=function(){if(this.options.legend.enabled){this.labelsCtx.save(),this.labelsCtx.font=this.legendFont;for(var t=0,e=this.mapLogicalXUnit(this.options.legend.indicatorSize),i=0;i<this.series.length;i++){var s=this.series[i];s.name&&(t+=this.getTextWidth(s.name,this.legendFont)+e+this.mapLogicalXUnit(this.options.elementSmallPadding+this.options.elementLargePadding))}for(var n=this.plotArea.left+this.plotArea.width/2-t/2,o=this.labelsCanvas.height-e,i=0;i<this.renderedSeries.length;i++){var s=this.renderedSeries[i];s.name&&(this.labelsCtx.fillStyle=s.colour,this.labelsCtx.fillRect(n,o,e,e),this.labelsCtx.textBaseline="middle",this.labelsCtx.fillStyle=this.options.legend.font.colour,n+=e+this.mapLogicalXUnit(this.options.elementSmallPadding),this.labelsCtx.fillText(s.name,n,o+e/2),n+=this.getTextWidth(s.name,this.legendFont)+this.mapLogicalXUnit(this.options.elementLargePadding))}this.labelsCtx.restore()}}},{"./tayberry.base.js":5,"./utils":12}],9:[function(t,e,i){"use strict";var s=t("./rect").Rect,n=t("./easing.js"),o=t("./utils.js"),r=t("./tayberry.base.js").Tayberry;r.prototype.onAnimate=function(t){var e,i;null===this.animationStart&&(this.animationStart=t),e=t-this.animationStart,i=Math.min(n.inQuad(e,this.animationLength),1);for(var s=0;s<this.series[0].data.length;s++)for(var o=0;o<this.series.length;o++){var r=this.series[o].data[s],a=this.yAxis.min<=0&&0<=this.yAxis.max?0:this.yAxis.min>0?this.yAxis.min:this.yAxis.max;this.renderedSeries[o].data[s]=a+i*(r-a)}this.redraw(!0),1>i&&(this.animator=requestAnimationFrame(this.onAnimate.bind(this)))},r.prototype.onMouseLeave=function(t){(t.currentTarget==this.plotCanvas&&t.relatedTarget!==this.tooltipElement||t.currentTarget==this.tooltipElement&&t.relatedTarget!==this.plotCanvas)&&(this.selectedItem={},this.tooltipElement.style.display="none",this.redraw())},r.prototype.handleMouseMove=function(t,e){var i=new s(this.plotCanvas.getBoundingClientRect()),n=!1;if(i.containsPoint(t,e)){var r=t-i.left,a=e-i.top,l=this.hitTest(this.mapLogicalXUnit(r),this.mapLogicalYUnit(a));if(l.found){var h=l.rect.top<l.rect.bottom,u=this.xAxis.getCategoryLabel(l.categoryIndex,this.series[0].data.length);this.tooltipElement.style.display="block";var c=o.formatString(this.options.tooltips.headerTemplate,{category:u},!0);if(this.options.tooltips.shared)for(var p=0;p<this.series.length;p++){var d=this.series[p],f=d.data[l.categoryIndex];c+=o.formatString(this.options.tooltips.valueTemplate,{value:this.options.yAxis.labelFormatter(f),name:d.name,colour:d.colour},!0)}else{var d=this.series[l.seriesIndex],f=d.data[l.categoryIndex];c+=o.formatString(this.options.tooltips.valueTemplate,{value:this.options.yAxis.labelFormatter(f),name:d.name,colour:d.colour},!0)}c+=this.options.tooltips.footerTemplate,this.tooltipElement.innerHTML=c;var m=this.tooltipElement.getBoundingClientRect();this.options.tooltips.shared||(this.tooltipElement.style.borderColor=this.renderedSeries[l.seriesIndex].colour),this.tooltipElement.style.left=window.pageXOffset+i.left+this.mapScreenUnit(l.rect.width)/2+l.rect.left/this.scaleFactor-m.width/2+"px",this.tooltipElement.style.top=window.pageYOffset+i.top+this.mapScreenUnit(l.rect.top)-m.height*(h?1:0)-this.options.elementSmallPadding*(h?1:-1)+"px",this.selectedItem=l,n=!0}}return n},r.prototype.onMouseMove=function(t){var e=o.assign({},this.selectedItem);this.handleMouseMove(t.clientX,t.clientY)||(this.selectedItem={}),(e.categoryIndex!==this.selectedItem.categoryIndex||e.seriesIndex!==this.selectedItem.seriesIndex)&&this.redraw()},r.prototype.onWindowResize=function(){this.tooltipElement.style.display="none",this.labelsCanvas.style.width=Math.floor(this.containerElement.clientWidth)+"px",this.labelsCanvas.style.height=Math.floor(this.containerElement.clientHeight)+"px",this.plotCanvas.style.width=Math.floor(this.containerElement.clientWidth)+"px",this.plotCanvas.style.height=Math.floor(this.containerElement.clientHeight)+"px",this.initialise(),this.updateFonts(),this.calculatePlotArea(),this.createTooltip(),this.redraw()}},{"./easing.js":2,"./rect":3,"./tayberry.base.js":5,"./utils.js":12}],10:[function(t,e,i){"use strict";!function(){var i=t("./tayberry.base.js").Tayberry;t("./tayberry.axes.js"),t("./tayberry.core.js"),t("./tayberry.drawing.js"),t("./tayberry.events.js"),t("./tayberry.defaults.js"),t("./tayberry.sizing.js"),e.exports={create:function(t,e){var s=new i;s.create(t),s.setOptions(e),s.render()}}}()},{"./tayberry.axes.js":4,"./tayberry.base.js":5,"./tayberry.core.js":6,"./tayberry.defaults.js":7,"./tayberry.drawing.js":8,"./tayberry.events.js":9,"./tayberry.sizing.js":11}],11:[function(t,e,i){"use strict";var s=t("./rect").Rect,n=t("./utils"),o=t("./tayberry.base.js").Tayberry;
o.mapVerticalPosition=function(t,e){switch(e){case"outside":return t>0?"bottom":"top";case"inside":return t>0?"top":"bottom";default:return"middle"}},o.prototype.mapLogicalXUnit=function(t){return this.scaleFactorX*t},o.prototype.mapLogicalYUnit=function(t){return this.scaleFactorY*t},o.prototype.mapScreenUnit=function(t){return t/this.scaleFactor},o.prototype.calculatePlotArea=function(){var t=5;this.plotArea=new s(0,0,this.labelsCanvas.width,this.labelsCanvas.height),this.options.title.text&&(this.plotArea.top+=this.mapLogicalYUnit(this.options.elementSmallPadding),this.plotArea.top+=this.getFontHeight(this.options.title.font)*this.getMultilineTextHeight(this.titleFont,this.labelsCanvas.width,this.options.title.text)),this.options.legend.enabled&&(this.plotArea.bottom-=this.mapLogicalYUnit(this.options.elementSmallPadding+this.options.elementLargePadding+this.options.legend.indicatorSize)),this.yAxis.adjustSize(this.plotArea,!0,!0),this.xAxis.adjustSize(this.plotArea,!0,!0);for(var e=0;t>e&&(this.yAxis.calculateExtent(),this.xAxis.calculateExtent(),this.yAxis.updateFormatter(),this.xAxis.updateFormatter(),this.yAxis.adjustSize(this.plotArea)||this.xAxis.adjustSize(this.plotArea));e++);this.plotArea.left=Math.ceil(this.plotArea.left),this.plotArea.top=Math.ceil(this.plotArea.top),this.plotArea.right=Math.floor(this.plotArea.right),this.plotArea.bottom=Math.floor(this.plotArea.bottom)},o.prototype.hitTest=function(t,e){var i={found:!1,categoryIndex:void 0,seriesIndex:void 0,rect:void 0},s=[],o="overlaid"===this.options.barMode;if(this.enumerateBars(function(i){return i.rect.containsPoint(t,e)&&(s.push({categoryIndex:i.categoryIndex,seriesIndex:i.seriesIndex,rect:i.rect}),!o)?!0:void 0}.bind(this)),s.length){i.found=!0;for(var r=0,a=s[0].rect.height,l=1;l<s.length;l++){var h=s[l];h.rect.height<a&&(r=l,a=h.rect.height)}i=n.assign(i,s[r])}return i},o.prototype.enumerateBars=function(t){var e=this.renderedSeries[0].data.length;if(e){var i="stacked"===this.options.barMode,o="overlaid"===this.options.barMode,r=this.options.swapAxes,a=this.plotArea.clone();r&&a.swapXY();for(var l=!i&&!o,h=i||o?1:this.series.length,u=a.width/e,c=this.yAxis.getOrigin(),p=0;e>p;p++)for(var d=a.left+Math.floor(p*u),f=a.left+Math.floor((p+1)*u),m=d+Math.ceil(u*this.options.categorySpacing/2),g=f-Math.floor(u*this.options.categorySpacing/2),y=c,b=c,v=0,x=0,A=0,C=0;C<this.renderedSeries.length;C++){var S=this.renderedSeries[C].data[p],w=Math.floor((g-m)/h),F=Math.floor(m+A*w),M=Math.ceil(m+(A+1)*w);if(!n.isMissingValue(S)){var k=this.yAxis.getValueDisplacement(S+(S>0?v:x)),T=new s(F,k,M,S>0?y:b);T.left+=Math.ceil(this.options.barPadding*this.scaleFactor/2),T.right-=Math.floor(this.options.barPadding*this.scaleFactor/2),T.right<T.left&&(T.right=T.left),r&&T.swapXY(),T.clip(this.plotArea);var L=t({seriesIndex:C,categoryIndex:p,series:this.renderedSeries[C],renderedSeries:this.renderedSeries[C],value:this.series[C].data[p],renderedValue:this.renderedSeries[C].data[p],rect:T,selected:this.selectedItem.categoryIndex===p&&(this.options.tooltips.shared||this.selectedItem.seriesIndex===C)});if(L)break;i?S>0?(v+=S,y=k):(x+=S,b=k):l&&A++}}}}},{"./rect":3,"./tayberry.base.js":5,"./utils":12}],12:[function(t,e,i){"use strict";!function(){i.identity=function(t){return t},i.isMissingValue=function(t){return null===t||"undefined"==typeof t||isNaN(t)&&"number"==typeof t},i.reduce=function(t,e,s){var n,o,r=arguments.length<=3||void 0===arguments[3]?!1:arguments[3];if(!t.reduce||s||r){if(s=s||i.identity,t.length)for(n=s(t[0]),o=1;o<t.length;o++){var a=s(t[o]);r&&i.isMissingValue(a)||(n=e(n,a))}}else n=t.reduce(function(t,i){return e(t,i)});return n},i.sign=Math.sign||function(t){return t>0?1:0>t?-1:0},i.now="undefined"!=typeof performance&&"undefined"!=typeof performance.now?performance.now:function(){return(new Date).getTime()};var t=function e(t,i,s){if(Array.isArray(s)||(s=[s]),!t&&Object.assign)return Object.assign.apply(Object,[i].concat(s));if(void 0===i||null===i)throw new TypeError("Cannot convert first argument to object");for(var n=Object(i),o=0;o<s.length;o++){var r=s[o];if(void 0!==r&&null!==r){r=Object(r);for(var a=Object.keys(r),l=0,h=a.length;h>l;l++){var u=a[l],c=r[u],p=Object.getOwnPropertyDescriptor(r,u);void 0!==p&&p.enumerable&&(t&&"object"==typeof n[u]&&!Array.isArray(c)&&"object"==typeof c?e(!0,n[u],c):n[u]=c)}}}return n};i.assign=function(e,i){return t(!1,e,i)},i.deepAssign=function(e,i){return t(!0,e,i)},i.formatString=function(t,e,s){return t.replace(/{(\w+)}/g,function(t,n){var o=e[n];return"undefined"!=typeof o?s?i.stringToHtml(o):o:t})},i.locateDecimalPoint=function(t){return Math.floor(Math.log(t)/Math.log(10))},i.formatNumberThousands=function(t){var e=arguments.length<=1||void 0===arguments[1]?0:arguments[1],i=t.toFixed(e).split(".");return i[0]=i[0].replace(/\B(?=(\d{3})+(?!\d))/g,","),i.join(".")},i.createAutoNumberFormatter=function(t){var e=arguments.length<=1||void 0===arguments[1]?"":arguments[1],s=arguments.length<=2||void 0===arguments[2]?"":arguments[2],n=arguments.length<=3||void 0===arguments[3]?2:arguments[3],o=i.locateDecimalPoint(t);return o=0>o?-o+n-1:0,function(t){return e+i.formatNumberThousands(t,o)+s}},i.createFixedNumberFormatter=function(t){var e=arguments.length<=1||void 0===arguments[1]?"":arguments[1],s=arguments.length<=2||void 0===arguments[2]?"":arguments[2],n=arguments.length<=3||void 0===arguments[3]?2:arguments[3];return function(t){return e+i.formatNumberThousands(t,n)+s}},i.createPercentageFormatter=function(t){var e=arguments.length<=1||void 0===arguments[1]?"":arguments[1],s=arguments.length<=2||void 0===arguments[2]?"%":arguments[2],n=arguments.length<=3||void 0===arguments[3]?2:arguments[3],o=i.locateDecimalPoint(100*t);return o=0>o?-o+n-1:0,function(t){return e+i.formatNumberThousands(100*t,o)+s}},i.stringToHtml=function(t){var e=document.createElement("div");return e.appendChild(document.createTextNode(t)),e.innerHTML},i.throttle=function(t,e){var i,s;return function(){var n=this,o=Date.now(),r=arguments;i&&i+e>o?(clearTimeout(s),s=setTimeout(function(){i=o,t.apply(n,r)},e)):(i=o,t.apply(n,r))}}}()},{}]},{},[10])(10)});
//# sourceMappingURL=tayberry.min.js.map
